2022-05-05 12:52:03.876 UTC,,,1347,,6273c873.543,1,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"ending log output to stderr",,"Future log output will go to log destination ""csvlog"".",,,,,,,"","postmaster",,0
2022-05-05 12:52:03.876 UTC,,,1347,,6273c873.543,2,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"starting PostgreSQL 14.1 on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0, 64-bit",,,,,,,,,"","postmaster",,0
2022-05-05 12:52:03.876 UTC,,,1347,,6273c873.543,3,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"listening on IPv4 address ""0.0.0.0"", port 5432",,,,,,,,,"","postmaster",,0
2022-05-05 12:52:03.876 UTC,,,1347,,6273c873.543,4,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"listening on IPv6 address ""::"", port 5432",,,,,,,,,"","postmaster",,0
2022-05-05 12:52:03.880 UTC,,,1347,,6273c873.543,5,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"listening on Unix socket ""/tmp/.s.PGSQL.5432""",,,,,,,,,"","postmaster",,0
2022-05-05 12:52:03.891 UTC,,,1352,,6273c873.548,1,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"database system was shut down at 2022-05-05 12:50:47 UTC",,,,,,,,,"","startup",,0
2022-05-05 12:52:03.906 UTC,,,1347,,6273c873.543,6,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"database system is ready to accept connections",,,,,,,,,"","postmaster",,0
2022-05-05 12:52:03.968 UTC,,,1358,,6273c873.54e,1,,2022-05-05 12:52:03 UTC,1/0,0,LOG,00000,"pg_cron scheduler started",,,,,,,,,"","pg_cron launcher",,0
2022-05-05 12:52:08.831 UTC,"postgres","postgres",1361,"192.168.56.1:52582",6273c878.551,1,"idle",2022-05-05 12:52:08 UTC,4/2,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 12:52:08.844 UTC,"postgres","postgres",1361,"192.168.56.1:52582",6273c878.551,2,"idle",2022-05-05 12:52:08 UTC,4/3,0,LOG,00000,"statement: CREATE EXTENSION pg_cron;
",,,,,,,,,"","client backend",,0
2022-05-05 13:13:59.223 UTC,"postgres","postgres",1437,"192.168.56.1:52740",6273cd97.59d,1,"idle",2022-05-05 13:13:59 UTC,4/27,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:13:59.226 UTC,"postgres","postgres",1437,"192.168.56.1:52740",6273cd97.59d,2,"idle",2022-05-05 13:13:59 UTC,4/28,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"--DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",12266,,"","client backend",,0
2022-05-05 13:16:20.167 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,1,"idle",2022-05-05 13:16:20 UTC,4/34,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:16:20.169 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,2,"idle",2022-05-05 13:16:20 UTC,4/35,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"--DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT pg_cron.schedule('30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",12269,,"","client backend",,0
2022-05-05 13:16:20.907 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,3,"idle",2022-05-05 13:16:20 UTC,4/36,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:16:20.911 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,4,"idle",2022-05-05 13:16:20 UTC,4/37,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"--DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT pg_cron.schedule('30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",12269,,"","client backend",,0
2022-05-05 13:16:21.378 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,5,"idle",2022-05-05 13:16:20 UTC,4/38,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:16:21.384 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,6,"idle",2022-05-05 13:16:20 UTC,4/39,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"--DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT pg_cron.schedule('30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",12269,,"","client backend",,0
2022-05-05 13:16:38.616 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,7,"idle",2022-05-05 13:16:20 UTC,4/40,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:16:38.621 UTC,"postgres","postgres",1448,"192.168.56.1:52769",6273ce24.5a8,8,"idle",2022-05-05 13:16:20 UTC,4/41,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"   SELECT cron.schedule('30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;",137,,"","client backend",,0
2022-05-05 13:19:42.455 UTC,"postgres","postgres",1478,"192.168.56.1:52816",6273ceee.5c6,1,"idle",2022-05-05 13:19:42 UTC,4/49,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:19:42.456 UTC,"postgres","postgres",1478,"192.168.56.1:52816",6273ceee.5c6,2,"idle",2022-05-05 13:19:42 UTC,4/50,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;",158,,"","client backend",,0
2022-05-05 13:19:43.065 UTC,"postgres","postgres",1478,"192.168.56.1:52816",6273ceee.5c6,3,"idle",2022-05-05 13:19:42 UTC,4/51,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:19:43.070 UTC,"postgres","postgres",1478,"192.168.56.1:52816",6273ceee.5c6,4,"idle",2022-05-05 13:19:42 UTC,4/52,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;",158,,"","client backend",,0
2022-05-05 13:19:43.427 UTC,"postgres","postgres",1478,"192.168.56.1:52816",6273ceee.5c6,5,"idle",2022-05-05 13:19:42 UTC,4/53,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:19:43.431 UTC,"postgres","postgres",1478,"192.168.56.1:52816",6273ceee.5c6,6,"idle",2022-05-05 13:19:42 UTC,4/54,0,ERROR,42601,"syntax error at or near ""schedule""",,,,,,"
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
 	schedule;",158,,"","client backend",,0
2022-05-05 13:20:22.098 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,1,"idle",2022-05-05 13:20:22 UTC,4/56,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:20:22.100 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,2,"idle",2022-05-05 13:20:22 UTC,4/57,0,LOG,00000,"statement: --DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:20:22.102 UTC,,,1347,,6273c873.543,7,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:20:22.114 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,3,"CREATE EXTENSION",2022-05-05 13:20:22 UTC,4/57,0,ERROR,42710,"extension ""pgaudit"" already exists",,,,,,"--DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:20:26.391 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,4,"idle",2022-05-05 13:20:22 UTC,4/58,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:20:26.415 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,5,"idle",2022-05-05 13:20:22 UTC,4/59,0,LOG,00000,"statement:     SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:20:31.871 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,6,"idle",2022-05-05 13:20:22 UTC,4/60,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:20:31.878 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,7,"idle",2022-05-05 13:20:22 UTC,4/61,0,LOG,00000,"statement: --DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:20:31.878 UTC,,,1347,,6273c873.543,8,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:20:31.885 UTC,"postgres","postgres",1482,"192.168.56.1:52821",6273cf16.5ca,8,"CREATE EXTENSION",2022-05-05 13:20:22 UTC,4/61,0,ERROR,42710,"extension ""pgaudit"" already exists",,,,,,"--DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION pgaudit;
CREATE EXTENSION pg_cron;



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:23:14.291 UTC,"postgres","postgres",1488,"192.168.56.1:52870",6273cfc2.5d0,1,"idle",2022-05-05 13:23:14 UTC,4/67,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:23:14.294 UTC,"postgres","postgres",1488,"192.168.56.1:52870",6273cfc2.5d0,2,"idle",2022-05-05 13:23:14 UTC,4/68,0,LOG,00000,"statement: CREATE EXTENSION IF NOT EXISTS pgcrypto;
",,,,,,,,,"","client backend",,0
2022-05-05 13:23:14.294 UTC,"postgres","postgres",1488,"192.168.56.1:52870",6273cfc2.5d0,3,"CREATE EXTENSION",2022-05-05 13:23:14 UTC,4/68,0,ERROR,58P01,"could not open extension control file ""/usr/local/pgsql/share/extension/pgcrypto.control"": No such file or directory",,,,,,"CREATE EXTENSION IF NOT EXISTS pgcrypto;
",,,"","client backend",,0
2022-05-05 13:27:07.074 UTC,"postgres","postgres",1501,"192.168.56.1:52907",6273d0ab.5dd,1,"idle",2022-05-05 13:27:07 UTC,4/76,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:27:07.076 UTC,"postgres","postgres",1501,"192.168.56.1:52907",6273d0ab.5dd,2,"idle",2022-05-05 13:27:07 UTC,4/77,0,LOG,00000,"statement: --DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:27:07.077 UTC,,,1347,,6273c873.543,9,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:27:07.107 UTC,"postgres","postgres",1501,"192.168.56.1:52907",6273d0ab.5dd,3,"ALTER TABLE",2022-05-05 13:27:07 UTC,4/77,860,ERROR,42P07,"relation ""stores"" already exists in schema ""allemployees""",,,,,,"--DROP TABLE allemployees.EMPLOYEES;
--DROP TABLE allemployees.payments;
--drop table allemployees.stores;
--DROP TABLE allemployees.performancereview;

--DROP ROLE HRSTAFF;
--DROP ROLE EMPLOYEE;


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:27:37.244 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,1,"idle",2022-05-05 13:27:37 UTC,4/79,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:27:37.246 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,2,"idle",2022-05-05 13:27:37 UTC,4/80,0,LOG,00000,"statement: 
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
DROP TABLE allemployees.EMPLOYEES;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:27:37.252 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,3,"DROP ROLE",2022-05-05 13:27:37 UTC,4/80,861,ERROR,2BP01,"role ""hrstaff"" cannot be dropped because some objects depend on it","privileges for table allemployees.employees",,,,,"
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
DROP TABLE allemployees.EMPLOYEES;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:27:45.820 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,4,"idle",2022-05-05 13:27:37 UTC,4/81,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:27:45.825 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,5,"idle",2022-05-05 13:27:37 UTC,4/82,0,LOG,00000,"statement: 
DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:27:45.825 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,6,"DROP ROLE",2022-05-05 13:27:37 UTC,4/82,0,ERROR,2BP01,"role ""hrstaff"" cannot be dropped because some objects depend on it","privileges for table allemployees.employees
privileges for table allemployees.stores
privileges for table allemployees.payments
privileges for table allemployees.performancereview",,,,,"
DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:27:47.425 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,7,"idle",2022-05-05 13:27:37 UTC,4/83,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:27:47.429 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,8,"idle",2022-05-05 13:27:37 UTC,4/84,0,LOG,00000,"statement: 
DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:27:47.431 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,9,"DROP ROLE",2022-05-05 13:27:37 UTC,4/84,0,ERROR,2BP01,"role ""hrstaff"" cannot be dropped because some objects depend on it","privileges for table allemployees.employees
privileges for table allemployees.stores
privileges for table allemployees.payments
privileges for table allemployees.performancereview",,,,,"
DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:27:54.253 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,10,"idle",2022-05-05 13:27:37 UTC,4/85,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:27:54.277 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,11,"idle",2022-05-05 13:27:37 UTC,4/86,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:27:54.284 UTC,,,1347,,6273c873.543,10,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:27:54.322 UTC,"postgres","postgres",1502,"192.168.56.1:52909",6273d0c9.5de,12,"INSERT",2022-05-05 13:27:37 UTC,4/86,862,ERROR,23503,"insert or update on table ""performancereview"" violates foreign key constraint ""performancereview_emp_id_fkey""","Key (emp_id)=(1DG01/01/2010) is not present in table ""employees"".",,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2017'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:28:49.301 UTC,"postgres","postgres",1504,"192.168.56.1:52912",6273d111.5e0,1,"idle",2022-05-05 13:28:49 UTC,4/88,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:28:49.304 UTC,"postgres","postgres",1504,"192.168.56.1:52912",6273d111.5e0,2,"idle",2022-05-05 13:28:49 UTC,4/89,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
       '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:28:49.306 UTC,,,1347,,6273c873.543,11,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:28:49.338 UTC,"postgres","postgres",1504,"192.168.56.1:52912",6273d111.5e0,3,"INSERT",2022-05-05 13:28:49 UTC,4/89,863,ERROR,23503,"insert or update on table ""performancereview"" violates foreign key constraint ""performancereview_emp_id_fkey""","Key (emp_id)=(1DG01/01/2010) is not present in table ""employees"".",,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
       '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:29:24.386 UTC,"postgres","postgres",1506,"192.168.56.1:52914",6273d134.5e2,1,"idle",2022-05-05 13:29:24 UTC,4/91,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:29:24.388 UTC,"postgres","postgres",1506,"192.168.56.1:52914",6273d134.5e2,2,"idle",2022-05-05 13:29:24 UTC,4/92,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
       '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:29:24.391 UTC,,,1347,,6273c873.543,12,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:29:24.423 UTC,"postgres","postgres",1506,"192.168.56.1:52914",6273d134.5e2,3,"INSERT",2022-05-05 13:29:24 UTC,4/92,864,ERROR,42601,"INSERT has more target columns than expressions",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG'
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
       '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",6535,,"","client backend",,0
2022-05-05 13:30:11.924 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,1,"idle",2022-05-05 13:30:11 UTC,4/94,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:30:11.926 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,2,"idle",2022-05-05 13:30:11 UTC,4/95,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:11.928 UTC,,,1347,,6273c873.543,13,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:30:12.003 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,3,"idle",2022-05-05 13:30:11 UTC,4/96,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:12.020 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,4,"idle",2022-05-05 13:30:11 UTC,4/97,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:12.024 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,5,"idle",2022-05-05 13:30:11 UTC,4/98,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:30:12.025 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,6,"idle",2022-05-05 13:30:11 UTC,4/99,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:12.029 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,7,"idle",2022-05-05 13:30:11 UTC,4/100,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:21.063 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,8,"idle",2022-05-05 13:30:11 UTC,4/101,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:30:21.106 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,9,"idle",2022-05-05 13:30:11 UTC,4/102,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:21.108 UTC,,,1347,,6273c873.543,14,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:30:21.164 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,10,"idle",2022-05-05 13:30:11 UTC,4/103,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:21.170 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,11,"idle",2022-05-05 13:30:11 UTC,4/104,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:21.173 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,12,"idle",2022-05-05 13:30:11 UTC,4/105,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:30:21.174 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,13,"idle",2022-05-05 13:30:11 UTC,4/106,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:21.177 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,14,"idle",2022-05-05 13:30:11 UTC,4/107,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:36.833 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,15,"idle",2022-05-05 13:30:11 UTC,4/108,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:30:36.841 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,16,"idle",2022-05-05 13:30:11 UTC,4/109,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:30:36.848 UTC,,,1347,,6273c873.543,15,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:30:36.939 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,17,"idle",2022-05-05 13:30:11 UTC,4/110,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:36.944 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,18,"idle",2022-05-05 13:30:11 UTC,4/111,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:36.947 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,19,"idle",2022-05-05 13:30:11 UTC,4/112,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:30:36.948 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,20,"idle",2022-05-05 13:30:11 UTC,4/113,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:36.951 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,21,"idle",2022-05-05 13:30:11 UTC,4/114,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:52.928 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,22,"idle",2022-05-05 13:30:11 UTC,4/115,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:30:52.961 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,23,"idle",2022-05-05 13:30:11 UTC,4/116,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:30:52.965 UTC,,,1347,,6273c873.543,16,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:30:53.020 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,24,"idle",2022-05-05 13:30:11 UTC,4/117,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:53.024 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,25,"idle",2022-05-05 13:30:11 UTC,4/118,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:53.026 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,26,"idle",2022-05-05 13:30:11 UTC,4/119,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:30:53.028 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,27,"idle",2022-05-05 13:30:11 UTC,4/120,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:53.030 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,28,"idle",2022-05-05 13:30:11 UTC,4/121,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:57.940 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,29,"idle",2022-05-05 13:30:11 UTC,4/122,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:30:57.946 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,30,"idle",2022-05-05 13:30:11 UTC,4/123,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:30:57.948 UTC,,,1347,,6273c873.543,17,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:30:57.995 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,31,"idle",2022-05-05 13:30:11 UTC,4/124,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:57.999 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,32,"idle",2022-05-05 13:30:11 UTC,4/125,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:58.002 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,33,"idle",2022-05-05 13:30:11 UTC,4/126,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:30:58.002 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,34,"idle",2022-05-05 13:30:11 UTC,4/127,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:30:58.004 UTC,"postgres","postgres",1509,"192.168.56.1:52917",6273d163.5e5,35,"idle",2022-05-05 13:30:11 UTC,4/128,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:31:21.179 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,1,"idle",2022-05-05 13:31:21 UTC,4/130,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:31:21.182 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,2,"idle",2022-05-05 13:31:21 UTC,4/131,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON ALL TABLES IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:31:21.184 UTC,,,1347,,6273c873.543,18,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:31:21.236 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,3,"idle",2022-05-05 13:31:21 UTC,4/132,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:31:21.239 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,4,"idle",2022-05-05 13:31:21 UTC,4/133,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:31:21.242 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,5,"idle",2022-05-05 13:31:21 UTC,4/134,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:31:21.243 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,6,"idle",2022-05-05 13:31:21 UTC,4/135,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:31:21.245 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,7,"idle",2022-05-05 13:31:21 UTC,4/136,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:31:29.621 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,8,"idle",2022-05-05 13:31:21 UTC,4/137,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:31:29.625 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,9,"idle",2022-05-05 13:31:21 UTC,4/138,0,LOG,00000,"statement:    SELECT * FROM allemployees.employees;",,,,,,,,,"","client backend",,0
2022-05-05 13:31:33.876 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,10,"idle",2022-05-05 13:31:21 UTC,4/139,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:31:33.880 UTC,"postgres","postgres",1512,"192.168.56.1:52923",6273d1a9.5e8,11,"idle",2022-05-05 13:31:21 UTC,4/140,0,LOG,00000,"statement:    SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);",,,,,,,,,"","client backend",,0
2022-05-05 13:33:56.235 UTC,"postgres","postgres",1517,"192.168.56.1:52935",6273d244.5ed,1,"idle",2022-05-05 13:33:56 UTC,4/166,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:33:56.238 UTC,"postgres","postgres",1517,"192.168.56.1:52935",6273d244.5ed,2,"idle",2022-05-05 13:33:56 UTC,4/167,0,LOG,00000,"statement:  CREATE EXTENSION pgcrypto;",,,,,,,,,"","client backend",,0
2022-05-05 13:33:56.239 UTC,"postgres","postgres",1517,"192.168.56.1:52935",6273d244.5ed,3,"CREATE EXTENSION",2022-05-05 13:33:56 UTC,4/167,0,ERROR,58P01,"could not open extension control file ""/usr/local/pgsql/share/extension/pgcrypto.control"": No such file or directory",,,,,," CREATE EXTENSION pgcrypto;",,,"","client backend",,0
2022-05-05 13:39:36.083 UTC,"postgres","postgres",1534,"192.168.56.1:52967",6273d398.5fe,1,"idle",2022-05-05 13:39:36 UTC,4/181,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:39:36.087 UTC,"postgres","postgres",1534,"192.168.56.1:52967",6273d398.5fe,2,"idle",2022-05-05 13:39:36 UTC,4/182,0,ERROR,42601,"syntax error at or near ""IN""",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON performancereview,payments IN SCHEMA allemployees 
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",1635,,"","client backend",,0
2022-05-05 13:41:21.539 UTC,"postgres","postgres",1539,"192.168.56.1:52978",6273d401.603,1,"idle",2022-05-05 13:41:21 UTC,4/186,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:41:21.543 UTC,"postgres","postgres",1539,"192.168.56.1:52978",6273d401.603,2,"idle",2022-05-05 13:41:21 UTC,4/187,0,LOG,00000,"statement:    GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   ",,,,,,,,,"","client backend",,0
2022-05-05 13:41:26.889 UTC,"postgres","postgres",1539,"192.168.56.1:52978",6273d401.603,3,"idle",2022-05-05 13:41:21 UTC,4/188,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:41:26.896 UTC,"postgres","postgres",1539,"192.168.56.1:52978",6273d401.603,4,"idle",2022-05-05 13:41:21 UTC,4/189,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:41:26.901 UTC,,,1347,,6273c873.543,19,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:41:26.936 UTC,"postgres","postgres",1539,"192.168.56.1:52978",6273d401.603,5,"CREATE EXTENSION",2022-05-05 13:41:21 UTC,4/189,878,ERROR,58P01,"could not open extension control file ""/usr/local/pgsql/share/extension/pgcrypto.control"": No such file or directory",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  


  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  

  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:46:31.111 UTC,"postgres","postgres",1555,"192.168.56.1:53019",6273d537.613,1,"idle",2022-05-05 13:46:31 UTC,4/201,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:46:31.115 UTC,"postgres","postgres",1555,"192.168.56.1:53019",6273d537.613,2,"idle",2022-05-05 13:46:31 UTC,4/202,0,LOG,00000,"statement:    SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
",,,,,,,,,"","client backend",,0
2022-05-05 13:46:57.707 UTC,"postgres","postgres",1556,"192.168.56.1:53020",6273d551.614,1,"idle",2022-05-05 13:46:57 UTC,4/204,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:46:57.709 UTC,"postgres","postgres",1556,"192.168.56.1:53020",6273d551.614,2,"idle",2022-05-05 13:46:57 UTC,4/205,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
  ALTER TABLE allemployees.employee ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancerveiw.emp_id = current_user);


  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:46:57.712 UTC,,,1347,,6273c873.543,20,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:46:57.761 UTC,"postgres","postgres",1556,"192.168.56.1:53020",6273d551.614,3,"ALTER TABLE",2022-05-05 13:46:57 UTC,4/205,879,ERROR,42P01,"relation ""allemployees.employee"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
  ALTER TABLE allemployees.employee ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancerveiw.emp_id = current_user);


  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:47:26.665 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,1,"idle",2022-05-05 13:47:26 UTC,4/207,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:47:26.694 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,2,"idle",2022-05-05 13:47:26 UTC,4/208,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancerveiw.emp_id = current_user);


  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:47:26.700 UTC,,,1347,,6273c873.543,21,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:47:26.738 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,3,"CREATE POLICY",2022-05-05 13:47:26 UTC,4/208,880,ERROR,42P01,"missing FROM-clause entry for table ""performancerveiw""",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancerveiw.emp_id = current_user);


  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,"","client backend",,0
2022-05-05 13:47:42.170 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,4,"idle",2022-05-05 13:47:26 UTC,4/209,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:47:42.174 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,5,"idle",2022-05-05 13:47:26 UTC,4/210,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20)
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);


  


   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:47:42.177 UTC,,,1347,,6273c873.543,22,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:47:42.249 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,6,"idle",2022-05-05 13:47:26 UTC,4/211,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:47:42.253 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,7,"idle",2022-05-05 13:47:26 UTC,4/212,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:47:42.255 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,8,"idle",2022-05-05 13:47:26 UTC,4/213,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:47:42.256 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,9,"idle",2022-05-05 13:47:26 UTC,4/214,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:47:42.258 UTC,"postgres","postgres",1559,"192.168.56.1:53031",6273d56e.617,10,"idle",2022-05-05 13:47:26 UTC,4/215,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:51:08.453 UTC,"postgres","postgres",1568,"192.168.56.1:53061",6273d64c.620,1,"idle",2022-05-05 13:51:08 UTC,4/223,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:51:08.462 UTC,"postgres","postgres",1568,"192.168.56.1:53061",6273d64c.620,2,"idle",2022-05-05 13:51:08 UTC,4/224,0,ERROR,42601,"syntax error at or near "".""",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20).
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);

   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",852,,"","client backend",,0
2022-05-05 13:51:47.476 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,1,"idle",2022-05-05 13:51:47 UTC,4/228,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:51:47.478 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,2,"idle",2022-05-05 13:51:47 UTC,4/229,0,ERROR,42601,"syntax error at or near "".""",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20).
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  ",852,,"","client backend",,0
2022-05-05 13:51:48.422 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,3,"idle",2022-05-05 13:51:47 UTC,4/230,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:51:48.425 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,4,"idle",2022-05-05 13:51:47 UTC,4/231,0,ERROR,42601,"syntax error at or near "".""",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20).
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  ",852,,"","client backend",,0
2022-05-05 13:51:58.642 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,5,"idle",2022-05-05 13:51:47 UTC,4/232,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:51:58.650 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,6,"idle",2022-05-05 13:51:47 UTC,4/233,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   --GRANT SELECT ON allemployees.payments WHERE allemployees.payments.emp_id = allemployees.employees.emp_id TO Employee;
   --GRANT SELECT ON performancereview WHERE performancereview.emp_id = employees.emp_id TO Employee;
	
    
    --create extension postgis;
    --CREATE EXTENSION pgcrypto;
    --TRUNCATE TABLE allemployees.payments;
    
    
   /* trigger
   ON SELECT OF payments/performance review
   */
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --pgp_sym_encrypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
    
   
  
    /*
    SELECT * FROM allemployees.payments 
    WHERE emp_id = current_user
    FROM SHARE;
  
    CREATE EXTENSION pgcrypto;
    TRUNCATE TABLE employees;
     */
     
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);

   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:51:58.655 UTC,,,1347,,6273c873.543,23,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:51:58.748 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,7,"idle",2022-05-05 13:51:47 UTC,4/234,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:51:58.753 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,8,"idle",2022-05-05 13:51:47 UTC,4/235,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:51:58.755 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,9,"idle",2022-05-05 13:51:47 UTC,4/236,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:51:58.756 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,10,"idle",2022-05-05 13:51:47 UTC,4/237,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:51:58.759 UTC,"postgres","postgres",1570,"192.168.56.1:53064",6273d673.622,11,"idle",2022-05-05 13:51:47 UTC,4/238,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:54:46.934 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,1,"idle",2022-05-05 13:54:46 UTC,4/244,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:54:46.937 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,2,"idle",2022-05-05 13:54:46 UTC,4/245,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     crypt('127SDHD3','emp_sec_key'),
      /*'127SDHD3',*/
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:54:46.940 UTC,,,1347,,6273c873.543,24,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:54:46.975 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,3,"INSERT",2022-05-05 13:54:46 UTC,4/245,883,ERROR,42883,"function crypt(unknown, unknown) does not exist",,"No function matches the given name and argument types. You might need to add explicit type casts.",,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     crypt('127SDHD3','emp_sec_key'),
      /*'127SDHD3',*/
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",3361,,"","client backend",,0
2022-05-05 13:54:57.657 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,4,"idle",2022-05-05 13:54:46 UTC,4/246,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 13:54:57.665 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,5,"idle",2022-05-05 13:54:46 UTC,4/247,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  );
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	
    
    




",,,,,,,,,"","client backend",,0
2022-05-05 13:54:57.670 UTC,,,1347,,6273c873.543,25,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 13:54:57.749 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,6,"idle",2022-05-05 13:54:46 UTC,4/248,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:54:57.753 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,7,"idle",2022-05-05 13:54:46 UTC,4/249,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:54:57.756 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,8,"idle",2022-05-05 13:54:46 UTC,4/250,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 13:54:57.757 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,9,"idle",2022-05-05 13:54:46 UTC,4/251,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 13:54:57.760 UTC,"postgres","postgres",1577,"192.168.56.1:53144",6273d726.629,10,"idle",2022-05-05 13:54:46 UTC,4/252,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:04:11.562 UTC,"postgres","humanresources",1606,"[local]",6273d956.646,1,"idle",2022-05-05 14:04:06 UTC,4/274,0,LOG,00000,"statement: SELECT n.nspname as ""Schema"",
  c.relname as ""Name"",
  CASE c.relkind WHEN 'r' THEN 'table' WHEN 'v' THEN 'view' WHEN 'm' THEN 'materialized view' WHEN 'i' THEN 'index' WHEN 'S' THEN 'sequence' WHEN 's' THEN 'special' WHEN 't' THEN 'TOAST table' WHEN 'f' THEN 'foreign table' WHEN 'p' THEN 'partitioned table' WHEN 'I' THEN 'partitioned index' END as ""Type"",
  pg_catalog.pg_get_userbyid(c.relowner) as ""Owner"",
  CASE c.relpersistence WHEN 'p' THEN 'permanent' WHEN 't' THEN 'temporary' WHEN 'u' THEN 'unlogged' END as ""Persistence"",
  am.amname as ""Access method"",
  pg_catalog.pg_size_pretty(pg_catalog.pg_table_size(c.oid)) as ""Size"",
  pg_catalog.obj_description(c.oid, 'pg_class') as ""Description""
FROM pg_catalog.pg_class c
     LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
     LEFT JOIN pg_catalog.pg_am am ON am.oid = c.relam
WHERE c.relkind IN ('r','p','v','m','S','f','')
      AND n.nspname <> 'pg_catalog'
      AND n.nspname !~ '^pg_toast'
      AND n.nspname <> 'information_schema'
  AND pg_catalog.pg_table_is_visible(c.oid)
ORDER BY 1,2;",,,,,,,,,"psql","client backend",,0
2022-05-05 14:12:41.575 UTC,"postgres","humanresources",1606,"[local]",6273d956.646,2,"idle",2022-05-05 14:04:06 UTC,4/275,0,LOG,00000,"statement: SELECT * FROM allemployees.employees;",,,,,,,,,"psql","client backend",,0
2022-05-05 14:12:41.575 UTC,"postgres","humanresources",1606,"[local]",6273d956.646,3,"SELECT",2022-05-05 14:04:06 UTC,4/275,0,ERROR,42P01,"relation ""allemployees.employees"" does not exist",,,,,,"SELECT * FROM allemployees.employees;",15,,"psql","client backend",,0
2022-05-05 14:13:39.162 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,1,"idle",2022-05-05 14:13:39 UTC,5/44,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:13:39.164 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,2,"idle",2022-05-05 14:13:39 UTC,5/45,0,LOG,00000,"statement: 	SELECT * FROM allemployee.emplyoyees;
",,,,,,,,,"","client backend",,0
2022-05-05 14:13:39.164 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,3,"SELECT",2022-05-05 14:13:39 UTC,5/45,0,ERROR,42P01,"relation ""allemployee.emplyoyees"" does not exist",,,,,,"	SELECT * FROM allemployee.emplyoyees;
",16,,"","client backend",,0
2022-05-05 14:13:46.837 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,4,"idle",2022-05-05 14:13:39 UTC,5/46,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:13:46.853 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,5,"idle",2022-05-05 14:13:39 UTC,5/47,0,LOG,00000,"statement: 	SELECT * FROM allemployees.emplyoyees;
",,,,,,,,,"","client backend",,0
2022-05-05 14:13:46.853 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,6,"SELECT",2022-05-05 14:13:39 UTC,5/47,0,ERROR,42P01,"relation ""allemployees.emplyoyees"" does not exist",,,,,,"	SELECT * FROM allemployees.emplyoyees;
",16,,"","client backend",,0
2022-05-05 14:13:47.909 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,7,"idle",2022-05-05 14:13:39 UTC,5/48,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:13:47.915 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,8,"idle",2022-05-05 14:13:39 UTC,5/49,0,LOG,00000,"statement: 	SELECT * FROM allemployees.emplyoyees;
",,,,,,,,,"","client backend",,0
2022-05-05 14:13:47.916 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,9,"SELECT",2022-05-05 14:13:39 UTC,5/49,0,ERROR,42P01,"relation ""allemployees.emplyoyees"" does not exist",,,,,,"	SELECT * FROM allemployees.emplyoyees;
",16,,"","client backend",,0
2022-05-05 14:13:56.515 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,10,"idle",2022-05-05 14:13:39 UTC,5/50,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:13:56.546 UTC,"postgres","postgres",1639,"192.168.56.1:53250",6273db93.667,11,"idle",2022-05-05 14:13:39 UTC,5/51,0,LOG,00000,"statement: 	SELECT * FROM allemployees.employees;
",,,,,,,,,"","client backend",,0
2022-05-05 14:19:44.045 UTC,"postgres","postgres",1665,"192.168.56.1:53278",6273dd00.681,1,"idle",2022-05-05 14:19:44 UTC,5/75,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:19:44.049 UTC,"postgres","postgres",1665,"192.168.56.1:53278",6273dd00.681,2,"idle",2022-05-05 14:19:44 UTC,5/76,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
  CREATE TABLE p5_2017 PARTITION OF performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-31-12');

  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:19:44.053 UTC,,,1347,,6273c873.543,26,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:19:44.074 UTC,"postgres","postgres",1665,"192.168.56.1:53278",6273dd00.681,3,"CREATE TABLE",2022-05-05 14:19:44 UTC,5/76,885,ERROR,22008,"date/time field value out of range: ""2017-31-12""",,"Perhaps you need a different ""datestyle"" setting.",,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
  CREATE TABLE p5_2017 PARTITION OF performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-31-12');

  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",1356,,"","client backend",,0
2022-05-05 14:19:54.498 UTC,"postgres","postgres",1665,"192.168.56.1:53278",6273dd00.681,4,"idle",2022-05-05 14:19:44 UTC,5/77,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:19:54.506 UTC,"postgres","postgres",1665,"192.168.56.1:53278",6273dd00.681,5,"idle",2022-05-05 14:19:44 UTC,5/78,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
  CREATE TABLE p5_2017 PARTITION OF performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');

  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:19:54.508 UTC,,,1347,,6273c873.543,27,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:19:54.546 UTC,"postgres","postgres",1665,"192.168.56.1:53278",6273dd00.681,6,"INSERT",2022-05-05 14:19:44 UTC,5/78,886,ERROR,23514,"no partition of relation ""performancereview"" found for row","Partition key of the failing row contains (date_created) = (2019-01-01).",,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
  CREATE TABLE p5_2017 PARTITION OF performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');

  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:20:46.780 UTC,"postgres","postgres",1670,"192.168.56.1:53282",6273dd3e.686,1,"idle",2022-05-05 14:20:46 UTC,5/82,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:20:46.784 UTC,"postgres","postgres",1670,"192.168.56.1:53282",6273dd3e.686,2,"idle",2022-05-05 14:20:46 UTC,5/83,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
  CREATE TABLE p5_2017 PARTITION OF performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');

  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:20:46.789 UTC,,,1347,,6273c873.543,28,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:20:46.829 UTC,"postgres","postgres",1670,"192.168.56.1:53282",6273dd3e.686,3,"INSERT",2022-05-05 14:20:46 UTC,5/83,887,ERROR,23514,"no partition of relation ""performancereview"" found for row","Partition key of the failing row contains (date_created) = (2019-01-01).",,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
  CREATE TABLE p5_2017 PARTITION OF performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');

  
 
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:22:16.426 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,1,"idle",2022-05-05 14:22:16 UTC,5/91,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:22:16.428 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,2,"idle",2022-05-05 14:22:16 UTC,5/92,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:22:16.431 UTC,,,1347,,6273c873.543,29,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:22:16.452 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,3,"CREATE TABLE",2022-05-05 14:22:16 UTC,5/92,888,ERROR,42P07,"relation ""p5_2018"" already exists",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:22:26.256 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,4,"idle",2022-05-05 14:22:16 UTC,5/93,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:22:26.271 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,5,"idle",2022-05-05 14:22:16 UTC,5/94,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:22:26.274 UTC,,,1347,,6273c873.543,30,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:22:26.315 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,6,"INSERT",2022-05-05 14:22:16 UTC,5/94,889,ERROR,23514,"no partition of relation ""performancereview"" found for row","Partition key of the failing row contains (date_created) = (2010-01-01).",,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:22:39.745 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,7,"idle",2022-05-05 14:22:16 UTC,5/95,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:22:39.760 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,8,"idle",2022-05-05 14:22:16 UTC,5/96,0,LOG,00000,"statement:  CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  
",,,,,,,,,"","client backend",,0
2022-05-05 14:22:39.763 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,9,"CREATE TABLE",2022-05-05 14:22:16 UTC,5/96,890,ERROR,42P17,"""performancereview"" is not partitioned",,,,,," CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  
",,,"","client backend",,0
2022-05-05 14:22:40.565 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,10,"idle",2022-05-05 14:22:16 UTC,5/97,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:22:40.572 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,11,"idle",2022-05-05 14:22:16 UTC,5/98,0,LOG,00000,"statement:  CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  
",,,,,,,,,"","client backend",,0
2022-05-05 14:22:40.572 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,12,"CREATE TABLE",2022-05-05 14:22:16 UTC,5/98,891,ERROR,42P17,"""performancereview"" is not partitioned",,,,,," CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  
",,,"","client backend",,0
2022-05-05 14:22:54.377 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,13,"idle",2022-05-05 14:22:16 UTC,5/99,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:22:54.411 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,14,"idle",2022-05-05 14:22:16 UTC,5/100,0,LOG,00000,"statement: 
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:22:54.482 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,15,"idle",2022-05-05 14:22:16 UTC,5/101,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:22:54.489 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,16,"idle",2022-05-05 14:22:16 UTC,5/102,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:22:54.492 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,17,"idle",2022-05-05 14:22:16 UTC,5/103,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:22:54.493 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,18,"idle",2022-05-05 14:22:16 UTC,5/104,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:22:54.496 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,19,"idle",2022-05-05 14:22:16 UTC,5/105,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:23:05.430 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,20,"idle",2022-05-05 14:22:16 UTC,5/106,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:05.440 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,21,"idle",2022-05-05 14:22:16 UTC,5/107,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:23:05.447 UTC,,,1347,,6273c873.543,31,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:23:05.459 UTC,"postgres","postgres",1675,"192.168.56.1:53301",6273dd98.68b,22,"CREATE TABLE",2022-05-05 14:22:16 UTC,5/107,894,ERROR,42P07,"relation ""performancereview"" already exists",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:23:28.354 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,1,"idle",2022-05-05 14:23:28 UTC,5/109,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:28.356 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,2,"idle",2022-05-05 14:23:28 UTC,5/110,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:23:28.359 UTC,,,1347,,6273c873.543,32,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:23:28.376 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,3,"CREATE TABLE",2022-05-05 14:23:28 UTC,5/110,895,ERROR,42P07,"relation ""performancereview"" already exists",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  ",,,"","client backend",,0
2022-05-05 14:23:32.747 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,4,"idle",2022-05-05 14:23:28 UTC,5/111,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:32.772 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,5,"idle",2022-05-05 14:23:28 UTC,5/112,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
",,,,,,,,,"","client backend",,0
2022-05-05 14:23:35.238 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,6,"idle",2022-05-05 14:23:28 UTC,5/113,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:35.242 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,7,"idle",2022-05-05 14:23:28 UTC,5/114,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:23:35.242 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,8,"DROP TABLE",2022-05-05 14:23:28 UTC,5/114,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:23:54.001 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,9,"idle",2022-05-05 14:23:28 UTC,5/115,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:54.036 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,10,"idle",2022-05-05 14:23:28 UTC,5/116,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:23:54.036 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,11,"DROP TABLE",2022-05-05 14:23:28 UTC,5/116,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:23:54.643 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,12,"idle",2022-05-05 14:23:28 UTC,5/117,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:54.647 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,13,"idle",2022-05-05 14:23:28 UTC,5/118,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:23:54.647 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,14,"DROP TABLE",2022-05-05 14:23:28 UTC,5/118,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:23:54.919 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,15,"idle",2022-05-05 14:23:28 UTC,5/119,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:54.922 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,16,"idle",2022-05-05 14:23:28 UTC,5/120,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:23:54.923 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,17,"DROP TABLE",2022-05-05 14:23:28 UTC,5/120,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:23:55.163 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,18,"idle",2022-05-05 14:23:28 UTC,5/121,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:55.168 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,19,"idle",2022-05-05 14:23:28 UTC,5/122,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:23:55.169 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,20,"DROP TABLE",2022-05-05 14:23:28 UTC,5/122,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:23:55.373 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,21,"idle",2022-05-05 14:23:28 UTC,5/123,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:23:55.377 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,22,"idle",2022-05-05 14:23:28 UTC,5/124,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:23:55.378 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,23,"DROP TABLE",2022-05-05 14:23:28 UTC,5/124,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:24:00.436 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,24,"idle",2022-05-05 14:23:28 UTC,5/125,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:00.473 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,25,"idle",2022-05-05 14:23:28 UTC,5/126,0,LOG,00000,"statement:  CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );",,,,,,,,,"","client backend",,0
2022-05-05 14:24:00.503 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,26,"idle",2022-05-05 14:23:28 UTC,5/127,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:24:00.509 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,27,"idle",2022-05-05 14:23:28 UTC,5/128,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:24:00.513 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,28,"idle",2022-05-05 14:23:28 UTC,5/129,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:24:00.514 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,29,"idle",2022-05-05 14:23:28 UTC,5/130,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:24:00.517 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,30,"idle",2022-05-05 14:23:28 UTC,5/131,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:24:01.522 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,31,"idle",2022-05-05 14:23:28 UTC,5/132,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:01.526 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,32,"idle",2022-05-05 14:23:28 UTC,5/133,0,LOG,00000,"statement:  CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );",,,,,,,,,"","client backend",,0
2022-05-05 14:24:01.526 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,33,"CREATE TABLE",2022-05-05 14:23:28 UTC,5/133,0,ERROR,42P07,"relation ""payments"" already exists",,,,,," CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );",,,"","client backend",,0
2022-05-05 14:24:09.734 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,34,"idle",2022-05-05 14:23:28 UTC,5/134,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:09.759 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,35,"idle",2022-05-05 14:23:28 UTC,5/135,0,LOG,00000,"statement: DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;",,,,,,,,,"","client backend",,0
2022-05-05 14:24:09.759 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,36,"DROP TABLE",2022-05-05 14:23:28 UTC,5/135,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;",,,"","client backend",,0
2022-05-05 14:24:14.059 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,37,"idle",2022-05-05 14:23:28 UTC,5/136,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:14.082 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,38,"idle",2022-05-05 14:23:28 UTC,5/137,0,LOG,00000,"statement: 
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;
",,,,,,,,,"","client backend",,0
2022-05-05 14:24:14.082 UTC,"postgres","postgres",1678,"192.168.56.1:53305",6273dde0.68e,39,"DROP TABLE",2022-05-05 14:23:28 UTC,5/137,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;
",,,"","client backend",,0
2022-05-05 14:24:35.456 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,1,"idle",2022-05-05 14:24:35 UTC,5/139,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:35.458 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,2,"idle",2022-05-05 14:24:35 UTC,5/140,0,LOG,00000,"statement: 
/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:24:35.459 UTC,,,1347,,6273c873.543,33,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:24:35.473 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,3,"CREATE TABLE",2022-05-05 14:24:35 UTC,5/140,901,ERROR,42P07,"relation ""payments"" already exists",,,,,,"
/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:24:36.332 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,4,"idle",2022-05-05 14:24:35 UTC,5/141,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:36.340 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,5,"idle",2022-05-05 14:24:35 UTC,5/142,0,LOG,00000,"statement: 
/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:24:36.340 UTC,,,1347,,6273c873.543,34,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:24:36.356 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,6,"CREATE TABLE",2022-05-05 14:24:35 UTC,5/142,902,ERROR,42P07,"relation ""payments"" already exists",,,,,,"
/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:24:41.073 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,7,"idle",2022-05-05 14:24:35 UTC,5/143,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:41.100 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,8,"idle",2022-05-05 14:24:35 UTC,5/144,0,LOG,00000,"statement: 

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;
",,,,,,,,,"","client backend",,0
2022-05-05 14:24:41.100 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,9,"DROP TABLE",2022-05-05 14:24:35 UTC,5/144,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;
",,,"","client backend",,0
2022-05-05 14:24:42.467 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,10,"idle",2022-05-05 14:24:35 UTC,5/145,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:42.470 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,11,"idle",2022-05-05 14:24:35 UTC,5/146,0,LOG,00000,"statement: 

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;
",,,,,,,,,"","client backend",,0
2022-05-05 14:24:42.470 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,12,"DROP TABLE",2022-05-05 14:24:35 UTC,5/146,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;
",,,"","client backend",,0
2022-05-05 14:24:42.877 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,13,"idle",2022-05-05 14:24:35 UTC,5/147,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:24:42.882 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,14,"idle",2022-05-05 14:24:35 UTC,5/148,0,LOG,00000,"statement: 

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;
",,,,,,,,,"","client backend",,0
2022-05-05 14:24:42.883 UTC,"postgres","postgres",1682,"192.168.56.1:53311",6273de23.692,15,"DROP TABLE",2022-05-05 14:24:35 UTC,5/148,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"

DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;
",,,"","client backend",,0
2022-05-05 14:25:08.686 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,1,"idle",2022-05-05 14:25:08 UTC,5/152,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:08.688 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,2,"idle",2022-05-05 14:25:08 UTC,5/153,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:25:08.688 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,3,"DROP TABLE",2022-05-05 14:25:08 UTC,5/153,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  ",,,"","client backend",,0
2022-05-05 14:25:09.293 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,4,"idle",2022-05-05 14:25:08 UTC,5/154,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:09.298 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,5,"idle",2022-05-05 14:25:08 UTC,5/155,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:25:09.299 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,6,"DROP TABLE",2022-05-05 14:25:08 UTC,5/155,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  ",,,"","client backend",,0
2022-05-05 14:25:14.478 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,7,"idle",2022-05-05 14:25:08 UTC,5/156,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:14.485 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,8,"idle",2022-05-05 14:25:08 UTC,5/157,0,LOG,00000,"statement:   
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:25:14.486 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,9,"CREATE TABLE",2022-05-05 14:25:08 UTC,5/157,0,ERROR,42P07,"relation ""performancereview"" already exists",,,,,,"  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  ",,,"","client backend",,0
2022-05-05 14:25:22.102 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,10,"idle",2022-05-05 14:25:08 UTC,5/158,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:22.106 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,11,"idle",2022-05-05 14:25:08 UTC,5/159,0,LOG,00000,"statement: DROP TABLE allemployees.performancereview;",,,,,,,,,"","client backend",,0
2022-05-05 14:25:22.107 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,12,"DROP TABLE",2022-05-05 14:25:08 UTC,5/159,0,ERROR,42P01,"table ""performancereview"" does not exist",,,,,,"DROP TABLE allemployees.performancereview;",,,"","client backend",,0
2022-05-05 14:25:22.782 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,13,"idle",2022-05-05 14:25:08 UTC,5/160,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:22.786 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,14,"idle",2022-05-05 14:25:08 UTC,5/161,0,LOG,00000,"statement: DROP TABLE allemployees.performancereview;",,,,,,,,,"","client backend",,0
2022-05-05 14:25:22.786 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,15,"DROP TABLE",2022-05-05 14:25:08 UTC,5/161,0,ERROR,42P01,"table ""performancereview"" does not exist",,,,,,"DROP TABLE allemployees.performancereview;",,,"","client backend",,0
2022-05-05 14:25:26.738 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,16,"idle",2022-05-05 14:25:08 UTC,5/162,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:26.766 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,17,"idle",2022-05-05 14:25:08 UTC,5/163,0,LOG,00000,"statement: drop table allemployees.stores;",,,,,,,,,"","client backend",,0
2022-05-05 14:25:26.766 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,18,"DROP TABLE",2022-05-05 14:25:08 UTC,5/163,0,ERROR,42P01,"table ""stores"" does not exist",,,,,,"drop table allemployees.stores;",,,"","client backend",,0
2022-05-05 14:25:31.094 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,19,"idle",2022-05-05 14:25:08 UTC,5/164,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:31.120 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,20,"idle",2022-05-05 14:25:08 UTC,5/165,0,LOG,00000,"statement: 
DROP TABLE allemployees.payments;",,,,,,,,,"","client backend",,0
2022-05-05 14:25:31.120 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,21,"DROP TABLE",2022-05-05 14:25:08 UTC,5/165,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"
DROP TABLE allemployees.payments;",,,"","client backend",,0
2022-05-05 14:25:34.667 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,22,"idle",2022-05-05 14:25:08 UTC,5/166,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:34.675 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,23,"idle",2022-05-05 14:25:08 UTC,5/167,0,LOG,00000,"statement: 
DROP TABLE allemployees.EMPLOYEES;",,,,,,,,,"","client backend",,0
2022-05-05 14:25:34.676 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,24,"DROP TABLE",2022-05-05 14:25:08 UTC,5/167,0,ERROR,42P01,"table ""employees"" does not exist",,,,,,"
DROP TABLE allemployees.EMPLOYEES;",,,"","client backend",,0
2022-05-05 14:25:38.245 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,25,"idle",2022-05-05 14:25:08 UTC,5/168,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:38.253 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,26,"idle",2022-05-05 14:25:08 UTC,5/169,0,LOG,00000,"statement: DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
",,,,,,,,,"","client backend",,0
2022-05-05 14:25:38.253 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,27,"DROP ROLE",2022-05-05 14:25:08 UTC,5/169,0,ERROR,42704,"role ""hrstaff"" does not exist",,,,,,"DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
",,,"","client backend",,0
2022-05-05 14:25:39.005 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,28,"idle",2022-05-05 14:25:08 UTC,5/170,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:39.009 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,29,"idle",2022-05-05 14:25:08 UTC,5/171,0,LOG,00000,"statement: DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
",,,,,,,,,"","client backend",,0
2022-05-05 14:25:39.009 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,30,"DROP ROLE",2022-05-05 14:25:08 UTC,5/171,0,ERROR,42704,"role ""hrstaff"" does not exist",,,,,,"DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
",,,"","client backend",,0
2022-05-05 14:25:46.662 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,31,"idle",2022-05-05 14:25:08 UTC,5/172,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:46.670 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,32,"idle",2022-05-05 14:25:08 UTC,5/173,0,LOG,00000,"statement: 


CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:25:46.675 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,33,"CREATE TABLE",2022-05-05 14:25:08 UTC,5/173,903,ERROR,42P07,"relation ""payments"" already exists",,,,,,"


CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:25:56.465 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,34,"idle",2022-05-05 14:25:08 UTC,5/174,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:25:56.470 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,35,"idle",2022-05-05 14:25:08 UTC,5/175,0,LOG,00000,"statement: 
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;",,,,,,,,,"","client backend",,0
2022-05-05 14:25:56.470 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,36,"DROP TABLE",2022-05-05 14:25:08 UTC,5/175,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;",,,"","client backend",,0
2022-05-05 14:26:04.506 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,37,"idle",2022-05-05 14:25:08 UTC,5/176,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:26:04.510 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,38,"idle",2022-05-05 14:25:08 UTC,5/177,0,LOG,00000,"statement: 


CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:26:04.516 UTC,"postgres","postgres",1688,"192.168.56.1:53312",6273de44.698,39,"CREATE TABLE",2022-05-05 14:25:08 UTC,5/177,904,ERROR,42P07,"relation ""payments"" already exists",,,,,,"


CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  ",,,"","client backend",,0
2022-05-05 14:26:54.191 UTC,"postgres","postgres",1694,"192.168.56.1:53318",6273deae.69e,1,"idle",2022-05-05 14:26:54 UTC,5/181,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:26:54.192 UTC,"postgres","postgres",1694,"192.168.56.1:53318",6273deae.69e,2,"idle",2022-05-05 14:26:54 UTC,5/182,0,LOG,00000,"statement: 

DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;",,,,,,,,,"","client backend",,0
2022-05-05 14:26:54.194 UTC,"postgres","postgres",1694,"192.168.56.1:53318",6273deae.69e,3,"DROP TABLE",2022-05-05 14:26:54 UTC,5/182,905,ERROR,42P01,"table ""stores"" does not exist",,,,,,"

DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;",,,"","client backend",,0
2022-05-05 14:27:10.272 UTC,"postgres","postgres",1694,"192.168.56.1:53318",6273deae.69e,4,"idle",2022-05-05 14:26:54 UTC,5/183,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:27:10.279 UTC,"postgres","postgres",1694,"192.168.56.1:53318",6273deae.69e,5,"idle",2022-05-05 14:26:54 UTC,5/184,0,LOG,00000,"statement: 


CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:27:10.284 UTC,"postgres","postgres",1694,"192.168.56.1:53318",6273deae.69e,6,"CREATE TABLE",2022-05-05 14:26:54 UTC,5/184,906,ERROR,42P07,"relation ""payments"" already exists",,,,,,"


CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:27:35.320 UTC,"postgres","postgres",1697,"192.168.56.1:53319",6273ded7.6a1,1,"idle",2022-05-05 14:27:35 UTC,5/186,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:27:35.324 UTC,"postgres","postgres",1697,"192.168.56.1:53319",6273ded7.6a1,2,"idle",2022-05-05 14:27:35 UTC,5/187,0,LOG,00000,"statement: 
DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;",,,,,,,,,"","client backend",,0
2022-05-05 14:27:35.326 UTC,"postgres","postgres",1697,"192.168.56.1:53319",6273ded7.6a1,3,"DROP TABLE",2022-05-05 14:27:35 UTC,5/187,907,ERROR,42P01,"table ""stores"" does not exist",,,,,,"
DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;",,,"","client backend",,0
2022-05-05 14:28:13.713 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,1,"idle",2022-05-05 14:28:13 UTC,5/191,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:28:13.715 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,2,"idle",2022-05-05 14:28:13 UTC,5/192,0,LOG,00000,"statement: 

CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);",,,,,,,,,"","client backend",,0
2022-05-05 14:28:13.719 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,3,"CREATE TABLE",2022-05-05 14:28:13 UTC,5/192,908,ERROR,42P07,"relation ""payments"" already exists",,,,,,"

CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);",,,"","client backend",,0
2022-05-05 14:28:24.938 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,4,"idle",2022-05-05 14:28:13 UTC,5/193,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:28:24.944 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,5,"idle",2022-05-05 14:28:13 UTC,5/194,0,LOG,00000,"statement: 
DROP TABLE payments;",,,,,,,,,"","client backend",,0
2022-05-05 14:28:30.349 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,6,"idle",2022-05-05 14:28:13 UTC,5/195,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:28:30.355 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,7,"idle",2022-05-05 14:28:13 UTC,5/196,0,LOG,00000,"statement: DROP TABLE performancereview;",,,,,,,,,"","client backend",,0
2022-05-05 14:28:31.969 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,8,"SELECT",2022-05-05 14:28:13 UTC,5/197,0,LOG,00000,"execute <unnamed>: 
    SELECT datname
    FROM pg_database
    WHERE datistemplate = $1
    
    ORDER BY datname
  ","parameters: $1 = 'f'",,,,,,,,"","client backend",,0
2022-05-05 14:28:33.325 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,9,"SELECT",2022-05-05 14:28:13 UTC,5/198,0,LOG,00000,"execute <unnamed>: 
    SELECT datname
    FROM pg_database
    WHERE datistemplate = $1
    
    ORDER BY datname
  ","parameters: $1 = 'f'",,,,,,,,"","client backend",,0
2022-05-05 14:28:37.863 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,10,"idle",2022-05-05 14:28:13 UTC,5/199,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:28:37.868 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,11,"idle",2022-05-05 14:28:13 UTC,5/200,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:28:37.870 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,12,"idle",2022-05-05 14:28:13 UTC,5/201,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:28:37.874 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,13,"idle",2022-05-05 14:28:13 UTC,5/202,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:28:37.877 UTC,"postgres","postgres",1703,"192.168.56.1:53332",6273df15.6a7,1,"idle",2022-05-05 14:28:37 UTC,6/33,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:28:37.879 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,14,"idle",2022-05-05 14:28:13 UTC,5/203,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:28:37.884 UTC,"postgres","postgres",1703,"192.168.56.1:53332",6273df15.6a7,2,"idle",2022-05-05 14:28:37 UTC,6/34,0,LOG,00000,"statement: 
    SELECT
      r.specific_name as id,
      r.routine_schema as routine_schema,
      r.routine_name as name,
      r.routine_type as routine_type,
      r.data_type as data_type
    FROM INFORMATION_SCHEMA.ROUTINES r
    where r.routine_schema not in ('sys', 'information_schema',
                                'pg_catalog', 'performance_schema')
    
    ORDER BY routine_schema, routine_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:28:37.900 UTC,"postgres","postgres",1703,"192.168.56.1:53332",6273df15.6a7,3,"idle",2022-05-05 14:28:37 UTC,6/35,0,LOG,00000,"statement: 
    select
        r.routine_schema as routine_schema,
        r.specific_name as specific_name,
        p.parameter_name as parameter_name,
        p.character_maximum_length as char_length,
        p.data_type as data_type
  from information_schema.routines r
  left join information_schema.parameters p
            on p.specific_schema = r.routine_schema
            and p.specific_name = r.specific_name
  where r.routine_schema not in ('sys', 'information_schema',
                                'pg_catalog', 'performance_schema')
    

      AND p.parameter_mode = 'IN'
  order by r.routine_schema,
          r.specific_name,
          p.ordinal_position;

  ",,,,,,,,,"","client backend",,0
2022-05-05 14:28:45.751 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,15,"idle",2022-05-05 14:28:13 UTC,5/204,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:28:45.760 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,16,"idle",2022-05-05 14:28:13 UTC,5/205,0,LOG,00000,"statement: 



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:28:45.799 UTC,"postgres","postgres",1701,"192.168.56.1:53330",6273defd.6a5,17,"INSERT",2022-05-05 14:28:13 UTC,5/205,911,ERROR,23514,"no partition of relation ""performancereview"" found for row","Partition key of the failing row contains (date_created) = (2010-01-01).",,,,,"



CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:29:35.917 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,1,"SELECT",2022-05-05 14:29:35 UTC,5/209,0,LOG,00000,"execute <unnamed>: 
    SELECT datname
    FROM pg_database
    WHERE datistemplate = $1
    
    ORDER BY datname
  ","parameters: $1 = 'f'",,,,,,,,"","client backend",,0
2022-05-05 14:29:36.954 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,2,"SELECT",2022-05-05 14:29:35 UTC,5/210,0,LOG,00000,"execute <unnamed>: 
    SELECT datname
    FROM pg_database
    WHERE datistemplate = $1
    
    ORDER BY datname
  ","parameters: $1 = 'f'",,,,,,,,"","client backend",,0
2022-05-05 14:29:37.464 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,3,"SELECT",2022-05-05 14:29:35 UTC,5/211,0,LOG,00000,"execute <unnamed>: 
    SELECT datname
    FROM pg_database
    WHERE datistemplate = $1
    
    ORDER BY datname
  ","parameters: $1 = 'f'",,,,,,,,"","client backend",,0
2022-05-05 14:29:39.834 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,4,"idle",2022-05-05 14:29:35 UTC,5/212,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:39.841 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,5,"idle",2022-05-05 14:29:35 UTC,5/213,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:39.842 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,1,"idle",2022-05-05 14:29:39 UTC,6/39,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:29:39.845 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,6,"idle",2022-05-05 14:29:35 UTC,5/214,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:29:39.845 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,2,"idle",2022-05-05 14:29:39 UTC,6/40,0,LOG,00000,"statement: 
    SELECT
      r.specific_name as id,
      r.routine_schema as routine_schema,
      r.routine_name as name,
      r.routine_type as routine_type,
      r.data_type as data_type
    FROM INFORMATION_SCHEMA.ROUTINES r
    where r.routine_schema not in ('sys', 'information_schema',
                                'pg_catalog', 'performance_schema')
    
    ORDER BY routine_schema, routine_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:39.846 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,7,"idle",2022-05-05 14:29:35 UTC,5/215,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:39.847 UTC,"postgres","postgres",1706,"192.168.56.1:53336",6273df4f.6aa,8,"idle",2022-05-05 14:29:35 UTC,5/216,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:39.857 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,3,"idle",2022-05-05 14:29:39 UTC,6/41,0,LOG,00000,"statement: 
    select
        r.routine_schema as routine_schema,
        r.specific_name as specific_name,
        p.parameter_name as parameter_name,
        p.character_maximum_length as char_length,
        p.data_type as data_type
  from information_schema.routines r
  left join information_schema.parameters p
            on p.specific_schema = r.routine_schema
            and p.specific_name = r.specific_name
  where r.routine_schema not in ('sys', 'information_schema',
                                'pg_catalog', 'performance_schema')
    

      AND p.parameter_mode = 'IN'
  order by r.routine_schema,
          r.specific_name,
          p.ordinal_position;

  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:51.990 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,4,"idle",2022-05-05 14:29:39 UTC,6/42,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:29:52.017 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,5,"idle",2022-05-05 14:29:39 UTC,6/43,0,LOG,00000,"statement: 


CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:52.076 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,6,"idle",2022-05-05 14:29:39 UTC,6/44,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:52.090 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,7,"idle",2022-05-05 14:29:39 UTC,6/45,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:52.107 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,8,"idle",2022-05-05 14:29:39 UTC,6/46,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:29:52.109 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,9,"idle",2022-05-05 14:29:39 UTC,6/47,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:29:52.112 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,10,"idle",2022-05-05 14:29:39 UTC,6/48,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:30:07.218 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,11,"idle",2022-05-05 14:29:39 UTC,6/49,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:30:07.222 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,12,"idle",2022-05-05 14:29:39 UTC,6/50,0,LOG,00000,"statement:  
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   ",,,,,,,,,"","client backend",,0
2022-05-05 14:30:19.549 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,13,"idle",2022-05-05 14:29:39 UTC,6/51,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:30:19.554 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,14,"idle",2022-05-05 14:29:39 UTC,6/52,0,LOG,00000,"statement: 
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   ",,,,,,,,,"","client backend",,0
2022-05-05 14:30:35.246 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,15,"idle",2022-05-05 14:29:39 UTC,6/53,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:30:35.250 UTC,"postgres","postgres",1708,"192.168.56.1:53337",6273df53.6ac,16,"idle",2022-05-05 14:29:39 UTC,6/54,0,LOG,00000,"statement: 
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   ",,,,,,,,,"","client backend",,0
2022-05-05 14:30:57.420 UTC,"postgres","postgres",1713,"192.168.56.1:53343",6273dfa1.6b1,1,"idle",2022-05-05 14:30:57 UTC,5/224,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:30:57.424 UTC,"postgres","postgres",1713,"192.168.56.1:53343",6273dfa1.6b1,2,"idle",2022-05-05 14:30:57 UTC,5/225,0,LOG,00000,"statement: 
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   ",,,,,,,,,"","client backend",,0
2022-05-05 14:30:57.426 UTC,"postgres","postgres",1713,"192.168.56.1:53343",6273dfa1.6b1,3,"INSERT",2022-05-05 14:30:57 UTC,5/225,917,ERROR,23514,"no partition of relation ""performancereview"" found for row","Partition key of the failing row contains (date_created) = (2010-01-01).",,,,,"
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '01/01/2019'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '01/01/2010'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '01/01/2019'
     );
     
   
   ",,,"","client backend",,0
2022-05-05 14:31:56.063 UTC,"postgres","postgres",1718,"192.168.56.1:53347",6273dfdc.6b6,1,"idle",2022-05-05 14:31:56 UTC,5/229,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:31:56.065 UTC,"postgres","postgres",1718,"192.168.56.1:53347",6273dfdc.6b6,2,"idle",2022-05-05 14:31:56 UTC,5/230,0,LOG,00000,"statement: 


DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:31:56.066 UTC,"postgres","postgres",1718,"192.168.56.1:53347",6273dfdc.6b6,3,"DROP TABLE",2022-05-05 14:31:56 UTC,5/230,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:31:57.093 UTC,"postgres","postgres",1718,"192.168.56.1:53347",6273dfdc.6b6,4,"idle",2022-05-05 14:31:56 UTC,5/231,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:31:57.103 UTC,"postgres","postgres",1718,"192.168.56.1:53347",6273dfdc.6b6,5,"idle",2022-05-05 14:31:56 UTC,5/232,0,LOG,00000,"statement: 


DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:31:57.103 UTC,"postgres","postgres",1718,"192.168.56.1:53347",6273dfdc.6b6,6,"DROP TABLE",2022-05-05 14:31:56 UTC,5/232,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE payments;
drop table stores;
DROP TABLE performancereview;

DROP TABLE EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,"","client backend",,0
2022-05-05 14:32:28.834 UTC,"postgres","postgres",1721,"192.168.56.1:53351",6273dffc.6b9,1,"idle",2022-05-05 14:32:28 UTC,5/234,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:32:28.836 UTC,"postgres","postgres",1721,"192.168.56.1:53351",6273dffc.6b9,2,"idle",2022-05-05 14:32:28 UTC,5/235,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;


",,,,,,,,,"","client backend",,0
2022-05-05 14:32:28.840 UTC,,,1347,,6273c873.543,35,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:32:28.920 UTC,"postgres","postgres",1721,"192.168.56.1:53351",6273dffc.6b9,3,"idle",2022-05-05 14:32:28 UTC,5/236,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:28.924 UTC,"postgres","postgres",1721,"192.168.56.1:53351",6273dffc.6b9,4,"idle",2022-05-05 14:32:28 UTC,5/237,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:28.926 UTC,"postgres","postgres",1721,"192.168.56.1:53351",6273dffc.6b9,5,"idle",2022-05-05 14:32:28 UTC,5/238,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:32:28.927 UTC,"postgres","postgres",1721,"192.168.56.1:53351",6273dffc.6b9,6,"idle",2022-05-05 14:32:28 UTC,5/239,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:28.929 UTC,"postgres","postgres",1721,"192.168.56.1:53351",6273dffc.6b9,7,"idle",2022-05-05 14:32:28 UTC,5/240,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:51.081 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,1,"idle",2022-05-05 14:32:51 UTC,5/242,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:32:51.084 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,2,"idle",2022-05-05 14:32:51 UTC,5/243,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
    SELECT * FROM p5_2017;


",,,,,,,,,"","client backend",,0
2022-05-05 14:32:51.091 UTC,,,1347,,6273c873.543,36,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:32:51.159 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,3,"idle",2022-05-05 14:32:51 UTC,5/244,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:51.163 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,4,"idle",2022-05-05 14:32:51 UTC,5/245,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:51.165 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,5,"idle",2022-05-05 14:32:51 UTC,5/246,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:32:51.166 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,6,"idle",2022-05-05 14:32:51 UTC,5/247,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:51.169 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,7,"idle",2022-05-05 14:32:51 UTC,5/248,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:32:54.341 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,8,"idle",2022-05-05 14:32:51 UTC,5/249,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:32:54.345 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,9,"idle",2022-05-05 14:32:51 UTC,5/250,0,LOG,00000,"statement:     SELECT * FROM p5_2017;
",,,,,,,,,"","client backend",,0
2022-05-05 14:32:55.322 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,10,"idle",2022-05-05 14:32:51 UTC,5/251,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:32:55.329 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,11,"idle",2022-05-05 14:32:51 UTC,5/252,0,LOG,00000,"statement:     SELECT * FROM p5_2017;
",,,,,,,,,"","client backend",,0
2022-05-05 14:32:56.380 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,12,"idle",2022-05-05 14:32:51 UTC,5/253,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:32:56.385 UTC,"postgres","postgres",1722,"192.168.56.1:53352",6273e013.6ba,13,"idle",2022-05-05 14:32:51 UTC,5/254,0,LOG,00000,"statement:     SELECT * FROM p5_2017;
",,,,,,,,,"","client backend",,0
2022-05-05 14:33:51.496 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,1,"idle",2022-05-05 14:33:51 UTC,5/281,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:33:51.498 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,2,"idle",2022-05-05 14:33:51 UTC,5/282,0,LOG,00000,"statement: DROP TABLE p5_2017;
DROP TABLE p5_2018;
DROP TABLE p5_2019;
DROP TABLE p5_2020;
",,,,,,,,,"","client backend",,0
2022-05-05 14:33:59.418 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,3,"idle",2022-05-05 14:33:51 UTC,5/283,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:33:59.426 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,4,"idle",2022-05-05 14:33:51 UTC,5/284,0,LOG,00000,"statement: 


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
    SELECT * FROM p5_2017;


",,,,,,,,,"","client backend",,0
2022-05-05 14:33:59.427 UTC,,,1347,,6273c873.543,37,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:33:59.440 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,5,"ALTER TABLE",2022-05-05 14:33:51 UTC,5/284,929,ERROR,42P07,"relation ""stores"" already exists in schema ""allemployees""",,,,,,"


/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
    SELECT * FROM p5_2017;


",,,"","client backend",,0
2022-05-05 14:34:08.701 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,6,"idle",2022-05-05 14:33:51 UTC,5/285,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:34:08.728 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,7,"idle",2022-05-05 14:33:51 UTC,5/286,0,LOG,00000,"statement: 
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
",,,,,,,,,"","client backend",,0
2022-05-05 14:34:13.155 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,8,"idle",2022-05-05 14:33:51 UTC,5/287,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:34:13.185 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,9,"idle",2022-05-05 14:33:51 UTC,5/288,0,LOG,00000,"statement: 

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  );
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE p5_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE p5_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE p5_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');

  

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
    SELECT * FROM p5_2017;


",,,,,,,,,"","client backend",,0
2022-05-05 14:34:13.186 UTC,,,1347,,6273c873.543,38,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:34:13.275 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,10,"idle",2022-05-05 14:33:51 UTC,5/289,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:34:13.284 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,11,"idle",2022-05-05 14:33:51 UTC,5/290,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:34:13.286 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,12,"idle",2022-05-05 14:33:51 UTC,5/291,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-05 14:34:13.286 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,13,"idle",2022-05-05 14:33:51 UTC,5/292,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:34:13.288 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,14,"idle",2022-05-05 14:33:51 UTC,5/293,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-05 14:34:21.196 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,15,"idle",2022-05-05 14:33:51 UTC,5/294,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:34:21.202 UTC,"postgres","postgres",1726,"192.168.56.1:53356",6273e04f.6be,16,"idle",2022-05-05 14:33:51 UTC,5/295,0,LOG,00000,"statement:     SELECT * FROM p5_2017;
",,,,,,,,,"","client backend",,0
2022-05-05 14:34:56.125 UTC,"postgres","postgres",1729,"192.168.56.1:53363",6273e090.6c1,1,"idle",2022-05-05 14:34:56 UTC,5/307,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:34:56.127 UTC,"postgres","postgres",1729,"192.168.56.1:53363",6273e090.6c1,2,"idle",2022-05-05 14:34:56 UTC,5/308,0,LOG,00000,"statement:     SELECT * FROM p5_2019;
",,,,,,,,,"","client backend",,0
2022-05-05 14:41:58.546 UTC,"postgres","postgres",1756,"192.168.56.1:53396",6273e236.6dc,1,"idle",2022-05-05 14:41:58 UTC,5/336,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:41:58.551 UTC,"postgres","postgres",1756,"192.168.56.1:53396",6273e236.6dc,2,"idle",2022-05-05 14:41:58 UTC,5/337,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;



/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,,,,,,,"","client backend",,0
2022-05-05 14:41:58.555 UTC,"postgres","postgres",1756,"192.168.56.1:53396",6273e236.6dc,3,"DROP TABLE",2022-05-05 14:41:58 UTC,5/337,933,ERROR,42P01,"table ""pr_2017"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;

DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;



/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,"","client backend",,0
2022-05-05 14:42:15.584 UTC,"postgres","postgres",1756,"192.168.56.1:53396",6273e236.6dc,4,"idle",2022-05-05 14:41:58 UTC,5/338,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:42:15.592 UTC,"postgres","postgres",1756,"192.168.56.1:53396",6273e236.6dc,5,"idle",2022-05-05 14:41:58 UTC,5/339,0,LOG,00000,"statement: 

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,,,,,,,"","client backend",,0
2022-05-05 14:42:15.593 UTC,,,1347,,6273c873.543,39,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:42:15.606 UTC,"postgres","postgres",1756,"192.168.56.1:53396",6273e236.6dc,6,"ALTER TABLE",2022-05-05 14:41:58 UTC,5/339,934,ERROR,42P07,"relation ""stores"" already exists in schema ""allemployees""",,,,,,"

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,"","client backend",,0
2022-05-05 14:44:35.562 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,1,"idle",2022-05-05 14:44:35 UTC,5/349,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:44:35.563 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,2,"idle",2022-05-05 14:44:35 UTC,5/350,0,LOG,00000,"statement: 
DROP TABLE STORES;
DROP TABLE EMPLOYEES;
DROP TABLE PERFROMANCEREVIEW;
DROP TABLE PAYMENTS; 
",,,,,,,,,"","client backend",,0
2022-05-05 14:44:35.563 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,3,"DROP TABLE",2022-05-05 14:44:35 UTC,5/350,0,ERROR,42P01,"table ""stores"" does not exist",,,,,,"
DROP TABLE STORES;
DROP TABLE EMPLOYEES;
DROP TABLE PERFROMANCEREVIEW;
DROP TABLE PAYMENTS; 
",,,"","client backend",,0
2022-05-05 14:44:42.735 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,4,"idle",2022-05-05 14:44:35 UTC,5/351,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:44:42.739 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,5,"idle",2022-05-05 14:44:35 UTC,5/352,0,LOG,00000,"statement: 

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,,,,,,,"","client backend",,0
2022-05-05 14:44:42.740 UTC,,,1347,,6273c873.543,40,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:44:42.755 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,6,"ALTER TABLE",2022-05-05 14:44:35 UTC,5/352,935,ERROR,42P07,"relation ""stores"" already exists in schema ""allemployees""",,,,,,"

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,"","client backend",,0
2022-05-05 14:44:49.240 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,7,"idle",2022-05-05 14:44:35 UTC,5/353,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:44:49.269 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,8,"idle",2022-05-05 14:44:35 UTC,5/354,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;
",,,,,,,,,"","client backend",,0
2022-05-05 14:44:57.147 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,9,"idle",2022-05-05 14:44:35 UTC,5/355,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:44:57.156 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,10,"idle",2022-05-05 14:44:35 UTC,5/356,0,LOG,00000,"statement: 

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,,,,,,,"","client backend",,0
2022-05-05 14:44:57.157 UTC,,,1347,,6273c873.543,41,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:44:57.183 UTC,"postgres","postgres",1766,"192.168.56.1:53413",6273e2d3.6e6,11,"CREATE TABLE",2022-05-05 14:44:35 UTC,5/356,937,ERROR,22008,"date/time field value out of range: ""2017-6-31""",,,,,,"

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-6-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-9-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-6-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-9-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');

  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",2166,,"","client backend",,0
2022-05-05 14:45:59.799 UTC,"postgres","postgres",1773,"192.168.56.1:53417",6273e327.6ed,1,"idle",2022-05-05 14:45:59 UTC,5/372,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:45:59.801 UTC,"postgres","postgres",1773,"192.168.56.1:53417",6273e327.6ed,2,"idle",2022-05-05 14:45:59 UTC,5/373,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;


DROP TABLE STORES;
DROP TABLE EMPLOYEES;
DROP TABLE PERFROMANCEREVIEW;
DROP TABLE PAYMENTS; 

DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;



/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-03-01') TO ('2021-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-06-01') TO ('2021-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-09-01') TO ('2021-12-31');

  
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,,,,,,,"","client backend",,0
2022-05-05 14:45:59.801 UTC,"postgres","postgres",1773,"192.168.56.1:53417",6273e327.6ed,3,"DROP TABLE",2022-05-05 14:45:59 UTC,5/373,0,ERROR,42P01,"table ""payments"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;


DROP TABLE STORES;
DROP TABLE EMPLOYEES;
DROP TABLE PERFROMANCEREVIEW;
DROP TABLE PAYMENTS; 

DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;



/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-03-01') TO ('2021-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-06-01') TO ('2021-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-09-01') TO ('2021-12-31');

  
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,"","client backend",,0
2022-05-05 14:46:07.544 UTC,"postgres","postgres",1773,"192.168.56.1:53417",6273e327.6ed,4,"idle",2022-05-05 14:45:59 UTC,5/374,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-05 14:46:07.558 UTC,"postgres","postgres",1773,"192.168.56.1:53417",6273e327.6ed,5,"idle",2022-05-05 14:45:59 UTC,5/375,0,LOG,00000,"statement: 

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-03-01') TO ('2021-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-06-01') TO ('2021-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-09-01') TO ('2021-12-31');

  
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",,,,,,,,,"","client backend",,0
2022-05-05 14:46:07.559 UTC,,,1347,,6273c873.543,42,,2022-05-05 12:52:03 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-05 14:46:07.598 UTC,"postgres","postgres",1773,"192.168.56.1:53417",6273e327.6ed,6,"CREATE TABLE",2022-05-05 14:45:59 UTC,5/375,941,ERROR,22008,"date/time field value out of range: ""2017-06-31""",,,,,,"

/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;
CREATE EXTENSION IF NOT EXISTS pgaudit;
CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-03-01') TO ('2017-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-06-01') TO ('2017-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-09-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-03-01') TO ('2018-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-06-01') TO ('2018-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-09-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-03-01') TO ('2019-06-31');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-06-01') TO ('2019-09-31');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-09-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-03-01') TO ('2020-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-06-01') TO ('2020-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-09-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-03-01') TO ('2021-06-31');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-06-01') TO ('2021-09-31');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-09-01') TO ('2021-12-31');

  
  
 
 SELECT current_user;
  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure';
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure';
  
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview', '30 3 * * 6', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments', '30 3 * * 6', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);





   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   


",2166,,"","client backend",,0
2022-05-06 04:20:48.687 UTC,"postgres","postgres",2769,"192.168.56.1:55311",6274a220.ad1,1,"idle",2022-05-06 04:20:48 UTC,4/885,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
