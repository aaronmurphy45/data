2022-05-06 15:31:39.339 UTC,,,1319,,62753f5b.527,1,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"ending log output to stderr",,"Future log output will go to log destination ""csvlog"".",,,,,,,"","postmaster",,0
2022-05-06 15:31:39.339 UTC,,,1319,,62753f5b.527,2,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"starting PostgreSQL 14.1 on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0, 64-bit",,,,,,,,,"","postmaster",,0
2022-05-06 15:31:39.339 UTC,,,1319,,62753f5b.527,3,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"listening on IPv4 address ""0.0.0.0"", port 5432",,,,,,,,,"","postmaster",,0
2022-05-06 15:31:39.339 UTC,,,1319,,62753f5b.527,4,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"listening on IPv6 address ""::"", port 5432",,,,,,,,,"","postmaster",,0
2022-05-06 15:31:39.342 UTC,,,1319,,62753f5b.527,5,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"listening on Unix socket ""/tmp/.s.PGSQL.5432""",,,,,,,,,"","postmaster",,0
2022-05-06 15:31:39.353 UTC,,,1324,,62753f5b.52c,1,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"database system was interrupted; last known up at 2022-05-06 14:43:52 UTC",,,,,,,,,"","startup",,0
2022-05-06 15:31:39.705 UTC,,,1324,,62753f5b.52c,2,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"database system was not properly shut down; automatic recovery in progress",,,,,,,,,"","startup",,0
2022-05-06 15:31:39.719 UTC,,,1324,,62753f5b.52c,3,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"redo starts at 0/2966940",,,,,,,,,"","startup",,0
2022-05-06 15:31:39.719 UTC,,,1324,,62753f5b.52c,4,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"invalid record length at 0/2966A28: wanted 24, got 0",,,,,,,,,"","startup",,0
2022-05-06 15:31:39.719 UTC,,,1324,,62753f5b.52c,5,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"redo done at 0/29669F0 system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s",,,,,,,,,"","startup",,0
2022-05-06 15:31:39.740 UTC,,,1319,,62753f5b.527,6,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"database system is ready to accept connections",,,,,,,,,"","postmaster",,0
2022-05-06 15:31:39.818 UTC,,,1330,,62753f5b.532,1,,2022-05-06 15:31:39 UTC,2/0,0,LOG,00000,"pg_cron scheduler started",,,,,,,,,"","pg_cron launcher",,0
2022-05-06 15:33:10.608 UTC,"postgres","postgres",1334,"192.168.56.1:57046",62753fb6.536,1,"idle",2022-05-06 15:33:10 UTC,4/2,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 15:33:10.615 UTC,"postgres","postgres",1334,"192.168.56.1:57046",62753fb6.536,2,"idle",2022-05-06 15:33:10 UTC,4/3,0,LOG,00000,"statement:    SELECT pg_start_backup('test backup', true);
",,,,,,,,,"","client backend",,0
2022-05-06 15:36:29.542 UTC,"postgres","postgres",1354,"192.168.56.1:57072",6275407d.54a,1,"idle",2022-05-06 15:36:29 UTC,4/11,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 15:36:29.543 UTC,"postgres","postgres",1354,"192.168.56.1:57072",6275407d.54a,2,"idle",2022-05-06 15:36:29 UTC,4/12,0,ERROR,42601,"syntax error at or near ""4""",,,,,,"    SELECT cron.schedule('BACKUPSTART', (5 4 31 * *), $$SELECT pg_start_backup('test backup', true));
",44,,"","client backend",,0
2022-05-06 15:38:10.702 UTC,"postgres","postgres",1359,"192.168.56.1:57079",627540e2.54f,1,"idle",2022-05-06 15:38:10 UTC,4/16,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 15:38:10.704 UTC,"postgres","postgres",1359,"192.168.56.1:57079",627540e2.54f,2,"idle",2022-05-06 15:38:10 UTC,4/17,0,ERROR,42601,"unterminated dollar-quoted string at or near ""$$SELECT pg_start_backup('test backup', true));
""",,,,,,"    SELECT cron.schedule('BACKUPSTART', '5 4 31 * *', $$SELECT pg_start_backup('test backup', true));
",55,,"","client backend",,0
2022-05-06 15:38:31.531 UTC,"postgres","postgres",1360,"192.168.56.1:57084",627540f7.550,1,"idle",2022-05-06 15:38:31 UTC,4/19,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 15:38:31.532 UTC,"postgres","postgres",1360,"192.168.56.1:57084",627540f7.550,2,"idle",2022-05-06 15:38:31 UTC,4/20,0,LOG,00000,"statement:     SELECT cron.schedule('BACKUPSTART', '5 4 31 * *', $$SELECT pg_start_backup('test backup', true)$$);
",,,,,,,,,"","client backend",,0
2022-05-06 15:39:13.227 UTC,"postgres","postgres",1363,"192.168.56.1:57087",62754121.553,1,"idle",2022-05-06 15:39:13 UTC,4/22,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 15:39:13.228 UTC,"postgres","postgres",1363,"192.168.56.1:57087",62754121.553,2,"idle",2022-05-06 15:39:13 UTC,4/23,0,LOG,00000,"statement:    	SELECT cron.schedule('BACKUPSTART', '10 4 31 * *', $$SELECT pg_stop_backup();$$);
",,,,,,,,,"","client backend",,0
2022-05-06 15:57:02.165 UTC,"postgres","postgres",1464,"192.168.56.1:57260",6275454e.5b8,1,"idle",2022-05-06 15:57:02 UTC,4/61,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 15:57:02.168 UTC,"postgres","postgres",1464,"192.168.56.1:57260",6275454e.5b8,2,"idle",2022-05-06 15:57:02 UTC,4/62,0,LOG,00000,"statement:     CREATE EXTENSION IF NOT EXISTS pgcrypto;
",,,,,,,,,"","client backend",,0
2022-05-06 15:57:02.172 UTC,"postgres","postgres",1464,"192.168.56.1:57260",6275454e.5b8,3,"CREATE EXTENSION",2022-05-06 15:57:02 UTC,4/62,0,ERROR,58P01,"could not open extension control file ""/usr/local/pgsql/share/extension/pgcrypto.control"": No such file or directory",,,,,,"    CREATE EXTENSION IF NOT EXISTS pgcrypto;
",,,"","client backend",,0
2022-05-06 16:19:38.446 UTC,"postgres","postgres",1593,"192.168.56.1:57483",62754a9a.639,1,"idle",2022-05-06 16:19:38 UTC,4/108,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:19:38.448 UTC,"postgres","postgres",1593,"192.168.56.1:57483",62754a9a.639,2,"idle",2022-05-06 16:19:38 UTC,4/109,0,LOG,00000,"statement:     SELECT pg_start_backup('test backup', true);
",,,,,,,,,"","client backend",,0
2022-05-06 16:19:38.448 UTC,"postgres","postgres",1593,"192.168.56.1:57483",62754a9a.639,3,"SELECT",2022-05-06 16:19:38 UTC,4/109,0,ERROR,55000,"a backup is already in progress",,"Run pg_stop_backup() and try again.",,,,"    SELECT pg_start_backup('test backup', true);
",,,"","client backend",,0
2022-05-06 16:19:43.785 UTC,"postgres","postgres",1593,"192.168.56.1:57483",62754a9a.639,4,"idle",2022-05-06 16:19:38 UTC,4/110,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:19:43.793 UTC,"postgres","postgres",1593,"192.168.56.1:57483",62754a9a.639,5,"idle",2022-05-06 16:19:38 UTC,4/111,0,LOG,00000,"statement:     SELECT pg_stop_backup()
",,,,,,,,,"","client backend",,0
2022-05-06 16:24:09.148 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,1,"idle",2022-05-06 16:24:09 UTC,4/121,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:09.150 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,2,"idle",2022-05-06 16:24:09 UTC,4/122,0,LOG,00000,"statement:     SELECT pg_stop_backup()
",,,,,,,,,"","client backend",,0
2022-05-06 16:24:09.150 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,3,"SELECT",2022-05-06 16:24:09 UTC,4/122,0,ERROR,55000,"exclusive backup not in progress",,,,,,"    SELECT pg_stop_backup()
",,,"","client backend",,0
2022-05-06 16:24:17.319 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,4,"idle",2022-05-06 16:24:09 UTC,4/123,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:17.329 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,5,"idle",2022-05-06 16:24:09 UTC,4/124,0,LOG,00000,"statement: 


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;


DROP TABLE STORES;
DROP TABLE EMPLOYEES;
DROP TABLE PERFROMANCEREVIEW;
DROP TABLE PAYMENTS; 


DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;

DROP TABLE payments_q1_2017;
DROP TABLE payments_q2_2017;
DROP TABLE payments_q3_2017;
DROP TABLE payments_q4_2017;

DROP TABLE payments_q1_2018;
DROP TABLE payments_q2_2018;
DROP TABLE payments_q3_2018;
DROP TABLE payments_q4_2018;

DROP TABLE payments_q1_2019;
DROP TABLE payments_q2_2019;
DROP TABLE payments_q3_2019;
DROP TABLE payments_q4_2019;

DROP TABLE payments_q1_2020;
DROP TABLE payments_q2_2020;
DROP TABLE payments_q3_2020;
DROP TABLE payments_q4_2020;










/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;



CREATE EXTENSION IF NOT EXISTS pgaudit;



CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-04-01') TO ('2017-06-30');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-07-01') TO ('2017-09-30');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-10-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-04-01') TO ('2018-06-30');
      CREATE TABLE payments_q3_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-07-01') TO ('2018-09-30');
       CREATE TABLE payments_q4_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-10-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-04-01') TO ('2019-06-30');
      CREATE TABLE payments_q3_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-07-01') TO ('2019-09-30');
       CREATE TABLE payments_q4_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-10-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-04-01') TO ('2020-06-30');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-07-01') TO ('2020-09-30');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-10-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-04-01') TO ('2021-06-30');
      CREATE TABLE payments_q3_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-07-01') TO ('2021-09-30');
       CREATE TABLE payments_q4_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-10-01') TO ('2021-12-31');

  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure' VALID UNTIL '2023-01-01';;
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure' VALID UNTIL '2023-01-01';;;
  
   
  
  
   GRANT SELECT, INSERT, UPDATE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.employees
   TO HRStaff;
   
   
   

   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview',  '5 4 * * *', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments',  '5 4 * * *', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);






   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   -- CREATE EXTENSION IF NOT EXISTS pgcrypto;

    
    -- Schedule to start back up 
   
    SELECT cron.schedule('BACKUPSTART', '5 4 31 * *', $$SELECT pg_start_backup('test backup', true)$$);
   
   -- Schedule to end back up 
   
   	SELECT cron.schedule('BACKUPSTART', '10 4 31 * *', $$SELECT pg_stop_backup();$$);
   
   


	--CREATE INDEX
    
    CREATE INDEX employee_index on allemployees.employees using btree ( emp_id );



  
  	

",,,,,,,,,"","client backend",,0
2022-05-06 16:24:17.388 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,6,"DROP TABLE",2022-05-06 16:24:09 UTC,4/124,1022,ERROR,42P01,"table ""stores"" does not exist",,,,,,"


DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;

DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;


DROP TABLE STORES;
DROP TABLE EMPLOYEES;
DROP TABLE PERFROMANCEREVIEW;
DROP TABLE PAYMENTS; 


DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;

DROP TABLE payments_q1_2017;
DROP TABLE payments_q2_2017;
DROP TABLE payments_q3_2017;
DROP TABLE payments_q4_2017;

DROP TABLE payments_q1_2018;
DROP TABLE payments_q2_2018;
DROP TABLE payments_q3_2018;
DROP TABLE payments_q4_2018;

DROP TABLE payments_q1_2019;
DROP TABLE payments_q2_2019;
DROP TABLE payments_q3_2019;
DROP TABLE payments_q4_2019;

DROP TABLE payments_q1_2020;
DROP TABLE payments_q2_2020;
DROP TABLE payments_q3_2020;
DROP TABLE payments_q4_2020;










/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;



CREATE EXTENSION IF NOT EXISTS pgaudit;



CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-04-01') TO ('2017-06-30');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-07-01') TO ('2017-09-30');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-10-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-04-01') TO ('2018-06-30');
      CREATE TABLE payments_q3_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-07-01') TO ('2018-09-30');
       CREATE TABLE payments_q4_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-10-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-04-01') TO ('2019-06-30');
      CREATE TABLE payments_q3_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-07-01') TO ('2019-09-30');
       CREATE TABLE payments_q4_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-10-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-04-01') TO ('2020-06-30');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-07-01') TO ('2020-09-30');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-10-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-04-01') TO ('2021-06-30');
      CREATE TABLE payments_q3_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-07-01') TO ('2021-09-30');
       CREATE TABLE payments_q4_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-10-01') TO ('2021-12-31');

  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure' VALID UNTIL '2023-01-01';;
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure' VALID UNTIL '2023-01-01';;;
  
   
  
  
   GRANT SELECT, INSERT, UPDATE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.employees
   TO HRStaff;
   
   
   

   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview',  '5 4 * * *', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments',  '5 4 * * *', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);






   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   -- CREATE EXTENSION IF NOT EXISTS pgcrypto;

    
    -- Schedule to start back up 
   
    SELECT cron.schedule('BACKUPSTART', '5 4 31 * *', $$SELECT pg_start_backup('test backup', true)$$);
   
   -- Schedule to end back up 
   
   	SELECT cron.schedule('BACKUPSTART', '10 4 31 * *', $$SELECT pg_stop_backup();$$);
   
   


	--CREATE INDEX
    
    CREATE INDEX employee_index on allemployees.employees using btree ( emp_id );



  
  	

",,,"","client backend",,0
2022-05-06 16:24:27.282 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,7,"idle",2022-05-06 16:24:09 UTC,4/125,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:27.286 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,8,"idle",2022-05-06 16:24:09 UTC,4/126,0,LOG,00000,"statement: 



/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;



CREATE EXTENSION IF NOT EXISTS pgaudit;



CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-04-01') TO ('2017-06-30');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-07-01') TO ('2017-09-30');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-10-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-04-01') TO ('2018-06-30');
      CREATE TABLE payments_q3_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-07-01') TO ('2018-09-30');
       CREATE TABLE payments_q4_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-10-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-04-01') TO ('2019-06-30');
      CREATE TABLE payments_q3_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-07-01') TO ('2019-09-30');
       CREATE TABLE payments_q4_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-10-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-04-01') TO ('2020-06-30');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-07-01') TO ('2020-09-30');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-10-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-04-01') TO ('2021-06-30');
      CREATE TABLE payments_q3_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-07-01') TO ('2021-09-30');
       CREATE TABLE payments_q4_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-10-01') TO ('2021-12-31');

  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure' VALID UNTIL '2023-01-01';;
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure' VALID UNTIL '2023-01-01';;;
  
   
  
  
   GRANT SELECT, INSERT, UPDATE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.employees
   TO HRStaff;
   
   
   

   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview',  '5 4 * * *', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments',  '5 4 * * *', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);






   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   -- CREATE EXTENSION IF NOT EXISTS pgcrypto;

    
    -- Schedule to start back up 
   
    SELECT cron.schedule('BACKUPSTART', '5 4 31 * *', $$SELECT pg_start_backup('test backup', true)$$);
   
   -- Schedule to end back up 
   
   	SELECT cron.schedule('BACKUPSTART', '10 4 31 * *', $$SELECT pg_stop_backup();$$);
   
   


	--CREATE INDEX
    
    CREATE INDEX employee_index on allemployees.employees using btree ( emp_id );



  
  	

",,,,,,,,,"","client backend",,0
2022-05-06 16:24:27.290 UTC,,,1319,,62753f5b.527,7,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-06 16:24:27.290 UTC,,,1319,,62753f5b.527,8,,2022-05-06 15:31:39 UTC,,0,LOG,55P02,"parameter ""archive_mode"" cannot be changed without restarting the server",,,,,,,,,"","postmaster",,0
2022-05-06 16:24:27.290 UTC,,,1319,,62753f5b.527,9,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"parameter ""archive_command"" changed to ""cp %p /usr/local/pgsql/data/archive/%f""",,,,,,,,,"","postmaster",,0
2022-05-06 16:24:27.290 UTC,,,1319,,62753f5b.527,10,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"parameter ""archive_timeout"" changed to ""60""",,,,,,,,,"","postmaster",,0
2022-05-06 16:24:27.290 UTC,,,1319,,62753f5b.527,11,,2022-05-06 15:31:39 UTC,,0,LOG,F0000,"configuration file ""/usr/local/pgsql/data/postgresql.conf"" contains errors; unaffected changes were applied",,,,,,,,,"","postmaster",,0
2022-05-06 16:24:27.374 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,9,"ALTER TABLE",2022-05-06 16:24:09 UTC,4/126,1023,ERROR,42P07,"relation ""stores"" already exists in schema ""allemployees""",,,,,,"



/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;



CREATE EXTENSION IF NOT EXISTS pgaudit;



CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-04-01') TO ('2017-06-30');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-07-01') TO ('2017-09-30');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-10-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-04-01') TO ('2018-06-30');
      CREATE TABLE payments_q3_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-07-01') TO ('2018-09-30');
       CREATE TABLE payments_q4_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-10-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-04-01') TO ('2019-06-30');
      CREATE TABLE payments_q3_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-07-01') TO ('2019-09-30');
       CREATE TABLE payments_q4_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-10-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-04-01') TO ('2020-06-30');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-07-01') TO ('2020-09-30');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-10-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-04-01') TO ('2021-06-30');
      CREATE TABLE payments_q3_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-07-01') TO ('2021-09-30');
       CREATE TABLE payments_q4_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-10-01') TO ('2021-12-31');

  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure' VALID UNTIL '2023-01-01';;
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure' VALID UNTIL '2023-01-01';;;
  
   
  
  
   GRANT SELECT, INSERT, UPDATE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.employees
   TO HRStaff;
   
   
   

   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview',  '5 4 * * *', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments',  '5 4 * * *', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);






   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   -- CREATE EXTENSION IF NOT EXISTS pgcrypto;

    
    -- Schedule to start back up 
   
    SELECT cron.schedule('BACKUPSTART', '5 4 31 * *', $$SELECT pg_start_backup('test backup', true)$$);
   
   -- Schedule to end back up 
   
   	SELECT cron.schedule('BACKUPSTART', '10 4 31 * *', $$SELECT pg_stop_backup();$$);
   
   


	--CREATE INDEX
    
    CREATE INDEX employee_index on allemployees.employees using btree ( emp_id );



  
  	

",,,"","client backend",,0
2022-05-06 16:24:34.480 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,10,"idle",2022-05-06 16:24:09 UTC,4/127,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:34.487 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,11,"idle",2022-05-06 16:24:09 UTC,4/128,0,LOG,00000,"statement: 
DROP TABLE allemployees.payments;
drop table allemployees.stores;
DROP TABLE allemployees.performancereview;

DROP TABLE allemployees.EMPLOYEES;",,,,,,,,,"","client backend",,0
2022-05-06 16:24:38.741 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,12,"idle",2022-05-06 16:24:09 UTC,4/129,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:38.751 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,13,"idle",2022-05-06 16:24:09 UTC,4/130,0,LOG,00000,"statement: 
DROP ROLE HRSTAFF;
DROP ROLE EMPLOYEE;
",,,,,,,,,"","client backend",,0
2022-05-06 16:24:42.094 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,14,"idle",2022-05-06 16:24:09 UTC,4/131,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:42.106 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,15,"idle",2022-05-06 16:24:09 UTC,4/132,0,LOG,00000,"statement: 
DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;
",,,,,,,,,"","client backend",,0
2022-05-06 16:24:42.107 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,16,"DROP TABLE",2022-05-06 16:24:09 UTC,4/132,0,ERROR,42P01,"table ""pr_2017"" does not exist",,,,,,"
DROP TABLE pr_2017;
DROP TABLE pr_2018;
DROP TABLE pr_2019;
DROP TABLE pr_2020;
",,,"","client backend",,0
2022-05-06 16:24:49.028 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,17,"idle",2022-05-06 16:24:09 UTC,4/133,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:49.033 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,18,"idle",2022-05-06 16:24:09 UTC,4/134,0,LOG,00000,"statement: 
DROP TABLE payments_q1_2017;
DROP TABLE payments_q2_2017;
DROP TABLE payments_q3_2017;
DROP TABLE payments_q4_2017;",,,,,,,,,"","client backend",,0
2022-05-06 16:24:49.033 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,19,"DROP TABLE",2022-05-06 16:24:09 UTC,4/134,0,ERROR,42P01,"table ""payments_q1_2017"" does not exist",,,,,,"
DROP TABLE payments_q1_2017;
DROP TABLE payments_q2_2017;
DROP TABLE payments_q3_2017;
DROP TABLE payments_q4_2017;",,,"","client backend",,0
2022-05-06 16:24:56.194 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,20,"idle",2022-05-06 16:24:09 UTC,4/135,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:24:56.222 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,21,"idle",2022-05-06 16:24:09 UTC,4/136,0,LOG,00000,"statement: 
DROP TABLE payments_q1_2018;
DROP TABLE payments_q2_2018;
DROP TABLE payments_q3_2018;
DROP TABLE payments_q4_2018;
",,,,,,,,,"","client backend",,0
2022-05-06 16:24:56.222 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,22,"DROP TABLE",2022-05-06 16:24:09 UTC,4/136,0,ERROR,42P01,"table ""payments_q1_2018"" does not exist",,,,,,"
DROP TABLE payments_q1_2018;
DROP TABLE payments_q2_2018;
DROP TABLE payments_q3_2018;
DROP TABLE payments_q4_2018;
",,,"","client backend",,0
2022-05-06 16:25:00.041 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,23,"idle",2022-05-06 16:24:09 UTC,4/137,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:25:00.063 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,24,"idle",2022-05-06 16:24:09 UTC,4/138,0,LOG,00000,"statement: 
DROP TABLE payments_q1_2020;
DROP TABLE payments_q2_2020;
DROP TABLE payments_q3_2020;
DROP TABLE payments_q4_2020;
",,,,,,,,,"","client backend",,0
2022-05-06 16:25:00.064 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,25,"DROP TABLE",2022-05-06 16:24:09 UTC,4/138,0,ERROR,42P01,"table ""payments_q1_2020"" does not exist",,,,,,"
DROP TABLE payments_q1_2020;
DROP TABLE payments_q2_2020;
DROP TABLE payments_q3_2020;
DROP TABLE payments_q4_2020;
",,,"","client backend",,0
2022-05-06 16:25:07.693 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,26,"idle",2022-05-06 16:24:09 UTC,4/139,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:25:07.706 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,27,"idle",2022-05-06 16:24:09 UTC,4/140,0,LOG,00000,"statement: 







/* Table Set Up */ 
--CREATE SCHEMA allemployees;
SELECT pg_reload_conf();
SELECT * FROM pg_database;
SHOW config_file;



CREATE EXTENSION IF NOT EXISTS pgaudit;



CREATE EXTENSION IF NOT EXISTS pg_cron;
--CREATE EXTENSION IF NOT EXISTS pgcrypto;





CREATE TABLE Employees(
  emp_id VARCHAR(20) PRIMARY KEY,
  emp_name VARCHAR(52),
  datejoined DATE,
  emp_position VARCHAR(20),
  ssnum VARCHAR(20),
  current_sal INTEGER
 );
  
  
 CREATE TABLE Stores( 
   str_id VARCHAR(20),
   str_location VARCHAR(52),
   str_num_employees INTEGER
 );
  
 CREATE TABLE Payments(
   paymenttype VARCHAR(52),
   emp_bank VARCHAR(30),
   status VARCHAR(10),
   emp_id VARCHAR(20),
   date_created DATE
  )PARTITION BY RANGE (date_created);
  ALTER TABLE Payments ADD FOREIGN KEY (emp_id)
  REFERENCES employees(emp_id);
  
  CREATE TABLE PerformanceReview(
    date_created DATE,
    review TEXT,
    reviewrating INTEGER,
    reviewbonus VARCHAR(20),
    emp_id VARCHAR(20)
     
  ) PARTITION BY RANGE (date_created);
  
  
  
  ALTER TABLE performancereview ADD FOREIGN KEY (emp_id)  
  REFERENCES employees(emp_id);
  
   
 ALTER TABLE stores SET SCHEMA allemployees;
 ALTER TABLE performancereview SET SCHEMA allemployees;
 ALTER TABLE payments SET SCHEMA allemployees;
 ALTER TABLE employees SET SCHEMA allemployees;
  
   CREATE TABLE pr_2017 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2017-01-01') TO ('2017-12-31');
   CREATE TABLE pr_2018 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2018-01-01') TO ('2018-12-31');
      CREATE TABLE pr_2019 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2019-01-01') TO ('2019-12-31');
       CREATE TABLE pr_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2020-01-01') TO ('2020-12-31');
           CREATE TABLE p5_2020 PARTITION OF allemployees.performancereview
    FOR VALUES FROM ('2021-01-01') TO ('2021-12-31');

  CREATE TABLE payments_q1_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-01-01') TO ('2017-03-31');
   CREATE TABLE payments_q2_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-04-01') TO ('2017-06-30');
      CREATE TABLE payments_q3_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-07-01') TO ('2017-09-30');
       CREATE TABLE payments_q4_2017 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2017-10-01') TO ('2017-12-31');

	CREATE TABLE payments_q1_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-01-01') TO ('2018-03-31');
   CREATE TABLE payments_q2_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-04-01') TO ('2018-06-30');
      CREATE TABLE payments_q3_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-07-01') TO ('2018-09-30');
       CREATE TABLE payments_q4_2018 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2018-10-01') TO ('2018-12-31');

	CREATE TABLE payments_q1_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-01-01') TO ('2019-03-31');
   CREATE TABLE payments_q2_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-04-01') TO ('2019-06-30');
      CREATE TABLE payments_q3_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-07-01') TO ('2019-09-30');
       CREATE TABLE payments_q4_2019 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2019-10-01') TO ('2019-12-31');

	CREATE TABLE payments_q1_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-01-01') TO ('2020-03-31');
   CREATE TABLE payments_q2_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-04-01') TO ('2020-06-30');
      CREATE TABLE payments_q3_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-07-01') TO ('2020-09-30');
       CREATE TABLE payments_q4_2020 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2020-10-01') TO ('2020-12-31');
	
    CREATE TABLE payments_q1_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-01-01') TO ('2021-03-31');
   CREATE TABLE payments_q2_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-04-01') TO ('2021-06-30');
      CREATE TABLE payments_q3_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-07-01') TO ('2021-09-30');
       CREATE TABLE payments_q4_2021 PARTITION OF allemployees.payments
    FOR VALUES FROM ('2021-10-01') TO ('2021-12-31');

  
  /* Role Set up */ 
 
  CREATE ROLE HRStaff LOGIN PASSWORD 'hrstaffsecure' VALID UNTIL '2023-01-01';;
  CREATE ROLE Employee LOGIN PASSWORD 'employeesecure' VALID UNTIL '2023-01-01';;;
  
   
  
  
   GRANT SELECT, INSERT, UPDATE
   ON allemployees.performancereview, allemployees.payments  
   TO HRStaff;
   
   
   GRANT SELECT, INSERT, UPDATE, DELETE
   ON allemployees.employees
   TO HRStaff;
   
   
   

   
   
   -- INSERTS -----------------------------------
 
   
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DF',
     'Aaron Murphy',
     '01/01/2020',
     'Employee',
     '1426362323',
     109202
   );
    
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DG',
     'Niall McNamara',
     '01/01/2020',
     'Employee',
     '142freufhfe',
     109202
   );
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DH',
     'Robbie Hatfield',
     '01/01/2020',
     'Employee',
     '1423uir243',
     109202
   );
    
     
   INSERT INTO allemployees.employees ( emp_id, emp_name, datejoined, emp_position, ssnum, current_sal) VALUES (
     '1DI',
     'Gabriel Hynes',
     '01/01/2020',
     'HR Staff',
     '14233542323',
     109323
   );
   
   INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '12736A733',
     'PAID',
     '1DF',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     '127SDHD3',
     'PAID',
     '1DH',     
     '01/01/2019'
   );
    INSERT INTO allemployees.payments ( paymenttype , emp_bank, status,emp_id, date_created ) VALUES (
     'CASH',
     --crypt('127SDHD3','emp_sec_key'),
      '127SDHD3',
     'PENDING',
     '1DI',
    '01/01/2019'
   );
   
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     10,
     'BONUS PAY',
     '1DF',
     '2019-05-05'
     );
     
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     0,
     'SACKED',
     '1DG',
     '2018-05-05'
     );
     
        
   INSERT INTO allemployees.performancereview (review, reviewrating, reviewbonus, emp_id, date_created) VALUES (
     'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In at eleifend lectus. Curabitur facilisis laoreet ex, a iaculis dui vehicula a. Nam semper tincidunt luctus. Curabitur condimentum pretium quam, et venenatis neque porttitor nec. Nam at odio sapien. Phasellus vitae dolor viverra, cursus arcu sollicitudin, imperdiet odio. Aliquam erat volutpat. Vivamus vitae ante rutrum, dapibus odio et, mattis felis. Praesent posuere viverra pharetra. Aenean tristique hendrerit lacinia. Proin vestibulum, tellus quis ornare malesuada, elit mi commodo arcu, eu pretium nulla lectus quis nisi.

    Donec tempor pellentesque hendrerit. Aliquam erat volutpat. Cras ultricies dui dolor, vel venenatis est mattis sed. Praesent neque urna, tincidunt ac tincidunt eget, bibendum maximus augue. Vivamus vel magna urna. Aenean sem nisi, vehicula eu lacus et, luctus porttitor leo. Vivamus id nulla orci. Aenean suscipit porta mi vel semper. Nam vestibulum augue fringilla leo dignissim, quis lobortis nisl scelerisque. Phasellus interdum, lorem vitae molestie blandit, felis dui finibus tellus, ac vestibulum felis purus id nibh. Nunc congue suscipit lorem, a tincidunt eros pulvinar sit amet.

    Donec nec elit ut risus eleifend accumsan venenatis quis nibh. Suspendisse vel ullamcorper leo, a consequat leo. Aenean nunc enim, rhoncus vitae lobortis in, blandit a nisi. Nunc vel nibh risus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In lobortis nisi a purus tristique elementum. In et sagittis nunc. Cras maximus molestie dapibus. Etiam vitae ultrices libero, vitae bibendum lorem.

    Sed ac luctus justo. Aenean facilisis turpis id velit sagittis, ac blandit nisi tincidunt. Aliquam a lectus in dolor feugiat condimentum. Nulla egestas viverra consectetur. Vivamus enim purus, blandit dignissim lacus eu, interdum lobortis odio. Sed maximus finibus felis ut lobortis. Sed eget blandit purus. Pellentesque sed sapien sed diam porta ornare quis eget nibh.

    Morbi laoreet, eros eu tincidunt blandit, ex massa tristique est, ac dignissim mi mi in tortor. Nulla fringilla volutpat vehicula. Nam pharetra, magna nec auctor porta, lectus sem imperdiet dolor, eget dictum urna orci quis sem. Morbi volutpat tellus nec mi scelerisque interdum. Nulla sed lacus tortor. Vivamus pharetra, tortor et accumsan tincidunt, nisl erat iaculis massa, sed feugiat orci leo ut leo. In hendrerit accumsan pharetra. Mauris non sodales nisi. Fusce elementum ex et lacinia commodo. Proin dignissim varius iaculis. Proin fermentum lacus in tincidunt aliquam. Morbi vitae orci augue.
	',
     5,
     'NOTHING',
     '1DH',
     '2019-05-05'
     );
     
   
   
   --------------------------------------------------------------------------------
    
   
    -- To delete performance reviews after 5 years.
     
    CREATE EXTENSION IF NOT EXISTS pg_cron;
     
    SELECT cron.schedule('DeletePerReview',  '5 4 * * *', $$DELETE FROM allemployees.performancereview WHERE date_created < now() - interval '5 year'$$);
  
    SELECT cron.schedule('DeletePayments',  '5 4 * * *', $$DELETE FROM allemployees.payments WHERE date_created < now() - interval '5 year'$$);

  
  
  
  
  -- Only allow users to view their own employee, payment or performance review files 
  
  ALTER TABLE allemployees.employees ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.performancereview ENABLE ROW LEVEL SECURITY;
  ALTER TABLE allemployees.payments ENABLE ROW LEVEL SECURITY;

  CREATE POLICY emp_view_emp ON allemployees.employees FOR ALL TO Employee USING (allemployees.employees.emp_id = current_user);
  CREATE POLICY emp_view_payment ON allemployees.payments FOR ALL TO Employee USING (allemployees.payments.emp_id = current_user);
  CREATE POLICY emp_view_pr ON allemployees.performancereview FOR ALL TO Employee USING (allemployees.performancereview.emp_id = current_user);






   
   SELECT * FROM allemployees.employees;
   SELECT * FROM allemployees.performancereview JOIN allemployees.employees USING(emp_id);
   SELECT * FROM allemployees.payments JOIN allemployees.employees USING(emp_id);
	

	SELECT * FROM allemployees.employees;
    
    
   -- CREATE EXTENSION IF NOT EXISTS pgcrypto;

    
    -- Schedule to start back up 
   
    SELECT cron.schedule('BACKUPSTART', '5 4 31 * *', $$SELECT pg_start_backup('test backup', true)$$);
   
   -- Schedule to end back up 
   
   	SELECT cron.schedule('BACKUPSTART', '10 4 31 * *', $$SELECT pg_stop_backup();$$);
   
   


	--CREATE INDEX
    
    CREATE INDEX employee_index on allemployees.employees using btree ( emp_id );



  
  	

",,,,,,,,,"","client backend",,0
2022-05-06 16:25:07.707 UTC,,,1319,,62753f5b.527,12,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-06 16:25:07.708 UTC,,,1319,,62753f5b.527,13,,2022-05-06 15:31:39 UTC,,0,LOG,55P02,"parameter ""archive_mode"" cannot be changed without restarting the server",,,,,,,,,"","postmaster",,0
2022-05-06 16:25:07.709 UTC,,,1319,,62753f5b.527,14,,2022-05-06 15:31:39 UTC,,0,LOG,F0000,"configuration file ""/usr/local/pgsql/data/postgresql.conf"" contains errors; unaffected changes were applied",,,,,,,,,"","postmaster",,0
2022-05-06 16:25:07.858 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,28,"idle",2022-05-06 16:24:09 UTC,4/141,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.tables
    WHERE table_type NOT LIKE '%VIEW%'
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-06 16:25:07.881 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,29,"idle",2022-05-06 16:24:09 UTC,4/142,0,LOG,00000,"statement: 
    SELECT
      table_schema as schema,
      table_name as name
    FROM information_schema.views
    
    ORDER BY table_schema, table_name
  ",,,,,,,,,"","client backend",,0
2022-05-06 16:25:07.885 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,30,"idle",2022-05-06 16:24:09 UTC,4/143,0,LOG,00000,"statement: select version()",,,,,,,,,"","client backend",,0
2022-05-06 16:25:07.887 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,31,"idle",2022-05-06 16:24:09 UTC,4/144,0,LOG,00000,"statement: 
    SELECT
      schemaname as schema,
      matviewname as name
    FROM pg_matviews
    
    order by schemaname, matviewname;
  ",,,,,,,,,"","client backend",,0
2022-05-06 16:25:07.891 UTC,"postgres","postgres",1622,"192.168.56.1:57508",62754ba9.656,32,"idle",2022-05-06 16:24:09 UTC,4/145,0,LOG,00000,"statement: 
    SELECT
      table_schema,
      table_name,
      column_name,
      is_nullable,
      ordinal_position,
      column_default,
      CASE
        WHEN character_maximum_length is not null  and udt_name != 'text'
          THEN CONCAT(udt_name, concat('(', concat(character_maximum_length::varchar(255), ')')))
        WHEN datetime_precision is not null THEN
          CONCAT(udt_name, concat('(', concat(datetime_precision::varchar(255), ')')))
        ELSE udt_name
      END as data_type
    FROM information_schema.columns
    
    ORDER BY table_schema, table_name, ordinal_position
  ",,,,,,,,,"","client backend",,0
2022-05-06 16:25:51.433 UTC,"postgres","postgres",1628,"192.168.56.1:57521",62754c0f.65c,1,"idle",2022-05-06 16:25:51 UTC,4/147,0,LOG,00000,"statement: SELECT pg_backend_pid() AS pid",,,,,,,,,"","client backend",,0
2022-05-06 16:25:51.434 UTC,"postgres","postgres",1628,"192.168.56.1:57521",62754c0f.65c,2,"idle",2022-05-06 16:25:51 UTC,4/148,0,LOG,00000,"statement:     SELECT pg_start_backup('test backup', true);
",,,,,,,,,"","client backend",,0
2022-05-06 16:29:19.945 UTC,,,1319,,62753f5b.527,15,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"received SIGHUP, reloading configuration files",,,,,,,,,"","postmaster",,0
2022-05-06 16:29:19.945 UTC,,,1319,,62753f5b.527,16,,2022-05-06 15:31:39 UTC,,0,LOG,55P02,"parameter ""archive_mode"" cannot be changed without restarting the server",,,,,,,,,"","postmaster",,0
2022-05-06 16:29:19.945 UTC,,,1319,,62753f5b.527,17,,2022-05-06 15:31:39 UTC,,0,LOG,F0000,"configuration file ""/usr/local/pgsql/data/postgresql.conf"" contains errors; unaffected changes were applied",,,,,,,,,"","postmaster",,0
2022-05-06 16:29:19.945 UTC,,,1319,,62753f5b.527,18,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"received smart shutdown request",,,,,,,,,"","postmaster",,0
2022-05-06 16:29:19.949 UTC,,,1330,,62753f5b.532,2,,2022-05-06 15:31:39 UTC,2/0,0,LOG,00000,"pg_cron scheduler shutting down",,,,,,,,,"","pg_cron launcher",,0
2022-05-06 16:29:19.964 UTC,,,1319,,62753f5b.527,19,,2022-05-06 15:31:39 UTC,,0,LOG,00000,"background worker ""logical replication launcher"" (PID 1331) exited with exit code 1",,,,,,,,,"","postmaster",,0
